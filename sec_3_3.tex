\section{Операции над родами структур}
\label{schemeops}
\p Операциями над родами структур называются формальные преобразования, позволяющие из~существующих текстов родов структур получать новые роды структур с~некоторыми заранее определёнными свойствами. Наибольшее прикладное значение имеют операция порождения множества структур данного рода и~операция синтеза.

\p[Порождение множества структур данного рода.] Пусть дан род структуры~$\Sigma$, имеющий типовую характеристику $d \in S[x_1,\ldots x_n]$ и~класс~$\Sigma$-объектов~$\mathcal K_\Sigma$. Операция порождения множества структур данного рода позволяет в~этом случае построить из~$\Sigma$ такой род структуры $\tilde \Sigma$, что класс $\tilde \Sigma$-объектов будет удовлетворять условию

 \[
 \mathcal K_{\tilde\Sigma} = \{(x_1,\ldots x_n, \tilde d)\mid \forall d (d \in \tilde d \imp (x_1,\ldots x_n, d) \in \mathcal K_\Sigma)\}.
\]

 Например, если~$\Sigma$ есть род структуры функции из~$x_1$ в~$x_2$, то~$\tilde \Sigma$, получаемый из~него операцией порождения множества структур данного рода, есть род структуры \emph{множества} функций из~$x_1$ в~$x_2$. В~$\tilde \Sigma$-объекте элементами множества, соответствующего родовой константе, являются множества, которые могут интерпретировать родовую константу~$\Sigma$ при фиксированной интерпретации базисных множеств.

Построить $\tilde \Sigma$ можно по~следующим правилам:
\begin{enumerate}
	\item базисные множества не~изменяются;
	\item типовая характеристика~$T$ вида $d \in S[x_1,\ldots x_n]$ заменяется на~$\tilde T$ вида $\tilde d \in \parts S[x_1,\ldots x_n]$;
	\item аксиома~$R$ заменяется на~аксиому~$\tilde R$ вида \[\forall u \in \tilde d ((u \mid d) R).\]
	%\item если аксиома~$R$ содержит имена внутренних термов $t_1,\ldots t_m$ в~качестве свободных переменных, то~она приводится к~эквивалентному замкнутому по~$t_1,\ldots t_m$ виду~$R'$ подстановкой выражений для термов $t_1,\ldots t_m$ в~формулу~$R$ (возможно, эту операцию придётся произвести несколько раз, т.~к. выражения для внутренних термов могут содержать в~качестве параметров имена других термов и~т.~д.), и~в~конструируемый род структуры добавляется аксиома~$\tilde R$ вида \[\forall u \in \tilde d ((u \mid d) R' ).\]
\end{enumerate}

Как видим, родовая константа в~этом процессе превращается во~множество, каждый элемент которого типизирован как исходная родовая константа. Заметим, что прежние выражения для внутренних термов~$\Sigma$ теряют смысл в~$\tilde\Sigma$ в~силу изменения типизации родовой константы.

Рассмотрим пример. Пусть~$x_1$ и~$x_2$~--- базисные множества, тогда

\begin{itemize}
	\item род структуры функции~$\Sigma$:

$d \in \parts (x_1\times x_2)$;

$R_1: \forall u \in x_1, \exists v \in x_2 ((u, v) \in d)$;

$R_2: \forall t_1\in d, \forall t_2 \in d (\pr_1(t_1) = \pr_1(t_2) \imp t_1 = t_2)$;

	%\begin{tabular}{l|l|l} $x_1$	& $\parts (x_1)$&	\\ $d_1$	& $\parts (x_1\times \mathbb R)$	& $\parts (x_1\times \mathbb R)$\\ $R_1$	&	& $\forall u\in x_1, \exists v\in \mathbb R((u,v)\in d_1)$\\ $R_2$	& &	$\forall t_1\in d_1, \forall t_2\in d_1((\pr_1(t_1)=\pr_1(t_2))\imp (t_1 =t_2))$\\	\end{tabular}
	
	\item род структуры множества функций $\tilde \Sigma$:

$\tilde d \in \parts \parts (x_1\times x_2)$;

$R_1: \forall z \in \tilde d, \forall u \in x_1, \exists v \in x_2 ((u, v) \in z)$;

$R_2: \forall z \in \tilde d, \forall t_1\in z, \forall t_2 \in z (\pr_1(t_1) = \pr_1(t_2) \imp t_1 = t_2)$.
%	\begin{tabular}{l|l|l} $x_1$	& $\parts (x_1)$&	\\ $\tilde d$	& $\parts\parts (x_1\times \mathbb R)$	& $\parts\parts (x_1\times \mathbb R)$\\ $\tilde R_1$	&	& $\forall z \in \tilde d, \forall u\in x_1, \exists v\in \mathbb R((u,v)\in z)$\\ $\tilde R_2$	& &	$\forall z \in \tilde d, \forall t_1\in z, \forall t_2\in z((\pr_1(t_1)=\pr_1(t_2))\imp (t_1 =t_2))$\\\end{tabular}
\end{itemize}
	

\begin{theorem}Если $\tilde \Sigma$ построена из~$\Sigma$ при помощи операции порождения структур данного рода, то~класс $\tilde \Sigma$-объектов удовлетворяет условию

 \[
 \mathcal K_{\tilde\Sigma} = \{(x_1,\ldots x_n, \tilde d)\mid \forall d (d \in \tilde d \imp (x_1,\ldots x_n, d) \in \mathcal K_\Sigma)\}.
\]\end{theorem}

\beginproof В~силу определения~$\parts$, $\tilde T$ $\sim$ $\tilde d \in \parts S[x_1,\ldots x_n] \sim \forall d (d\in \tilde d \imp d \in S[x_1,\ldots x_n])$, откуда $\tilde T \sim \forall d (d\in \tilde d \imp T)$. По~определению $\tilde R \sim \forall d (d\in \tilde d \imp R)$, из~чего следует \[\tilde T \& \tilde R \sim \forall d (d \in \tilde d \imp T \& R),\] откуда и~вытекает требуемое.\endproof

Род структуры $\tilde \Sigma$, полученный операцией порождения множества структур данного рода, заведомо непротиворечив, т.~к. $(\xi_1,\ldots \xi_n, \varnothing)$ есть, как легко видеть, $\tilde \Sigma$-объект при любых множествах $\xi_1,\ldots \xi_n$.

\begin{exercise}Докажите, что среди $\tilde \Sigma$-объектов $(\xi_1,\ldots \xi_n, \tilde \delta)$ существуют объекты с~непустым~$\tilde \delta$ тогда и~только тогда, когда~$\Sigma$ непротиворечив.
\end{exercise}

\begin{theorem}Если~$F$~--- теорема~$\Sigma$, то~формула~$\tilde F$ вида $\forall u \in \tilde d (u\mid d)F$ есть теорема $\tilde \Sigma$.\end{theorem}

\beginproof При доказательстве предыдущей теоремы было установлено, что \[\vdash \tilde T \& \tilde R \imp \forall u (u \in \tilde d \imp (u\mid d) (T \& R)).\]

Но если $\mathcal T' \vdash T \& R \imp F$, то~$\mathcal T' \vdash (u\mid d) (T \& R) \imp (u\mid d)F$, и~\[
\mathcal T' \vdash \tilde T \& \tilde R \imp \forall u (u \in \tilde d \imp (u\mid d) F),\] т.~е. $\tilde F$~--- теорема $\tilde \Sigma$.\endproof

\p[Синтез родов структур.] Потребность в~синтезе родов структур возникает, когда имеется набор родов структур, описывающих различные аспекты изучаемой области, и~требуется построить обобщающий, комплексный род структуры. Пусть даны род структуры~$\Sigma$ с~типовой характеристикой~$T_\Sigma$ и~аксиомой~$R_\Sigma$ и~род структуры~$\Theta$ с~типовой характеристикой~$T_\Theta$ и~аксиомой~$R_\Theta$. Теоретико-множественные интерпретации~$\Sigma$ и~$\Theta$ будут рассматриваться в~некоторой единой теории $\mathcal T'$.

Везде в~дальнейшем мы~будем предполагать, что имена всех конституэнт выбраны таким образом, что ни~одно имя конституэнты (за~исключением, может быть, имён вспомогательных базисных множеств) из~$\Sigma$ не~встречается среди имён конституэнт~$\Theta$: простой перенумерацией конституэнт одной из~родовых структур этого всегда можно добиться. Таким образом, текст, полученный простым объединением текстов~$\Sigma$ и~$\Theta$, является родом структуры с~типовой характеристикой~$T_\Sigma \& T_\Theta$ и~аксиомой~$R_\Sigma\& R_\Theta$. Всякая пара, состоящая из $\Sigma$- и~$\Theta$-объектов, будет его объектом, поэтому класс теоретико-множественных интерпретаций такого рода структуры будет в~некотором смысле равен $\mathcal K_{\Sigma}\times \mathcal K_{\Theta}$ и~не~будет пустым, если одновременно не~пусты $\mathcal K_{\Sigma}$ и~$\mathcal K_{\Theta}$.

Обычного слияния текстов родов структур бывает недостаточно: часто к~получившемуся роду структуры необходимо добавлять утверждения о~тождестве некоторых множеств~$\Sigma$ некоторым множествам~$\Theta$.

Рассмотрим пример. Предположим, что имеется род структуры~$\Sigma$ линейного векторного пространства над полем действительных чисел~$\mathbb R$ с~базисным множеством векторов~$x_1$ и~родовой константой $d_1\in \parts(x_1\times x_1\times x_1) \times \parts(\mathbb R\times x_1\times x_1)$. Пусть далее имеется род структуры~$\Theta$ множества функций из~$x_2$ в~$x_3$ с~родовой константой $d_2 \in \parts \parts (x_2 \times x_3)$. Объединив тексты этих родов структур и~отождествив множество функций с~базисным множеством векторов, т.~е. добавив условие~$d_2 = x_1$, мы~получим систему, некоторым образом описывающую линейные пространства над множеством функций. Эта система, однако, не~будет являться родом структуры, т.~к. соотношение~$d_2 = x_1$ не~является биективно переносимым. Но~мы~можем обойти эту ситуацию следующим образом: отбросить базисное множество~$x_1$, родовую константу~$d_1$ заменить на~$\tilde d \in \parts(\parts (x_2 \times x_3)\times \parts (x_2 \times x_3)\times \parts (x_2 \times x_3)) \times \parts(\mathbb R\times \parts (x_2 \times x_3)\times \parts (x_2 \times x_3))$, добавить аксиому $\tilde d\in \parts(d_2\times d_2\times d_2) \times \parts(\mathbb R\times d_2\times d_2)$ и~по~всему тексту заменить~$x_1$ на~$d_2$. Получившаяся система уже будет родом структуры с~вполне корректной типовой характеристикой и~биективно переносимой аксиомой, класс теоретико-множественных интерпретаций которого представляет собой класс линейных пространств функций над полем действительных чисел.

Подобную процедуру мы~можем проделать в~любом случае, когда базисное множество~$\Sigma$ отождествляется с~термом рода структуры~$\Theta$ типа~$\parts (S)$ (т.~е. с~термом, имеющим характер множества, но~не~элемента или кортежа). Разумеется, чтобы привести типизацию этого терма к~нужному виду, можно воспользоваться операцией порождения множества структур данного рода над~$\Theta$.

Рассмотрим ещё один, прикладной, пример: пусть имеется род структуры, описывающий <<теорию субординации>> в~организации, в~котором задано множество сотрудников~$x_1$, и~на~этом множестве введено отношение <<подчинения>> $d_1 \in \parts (x_1 \times x_1)$. Пусть, кроме этого, имеется род структуры, описывающий <<теорию родства>>, в~котором задано множество людей~$x_2$ и~на~этом множестве введено отношение <<быть родителем>> $d_2 \in \parts (x_2 \times x_2)$. Если теперь отождествить множество сотрудников в~первой теории и~людей во~второй (что в~рассматриваемом случае можно сделать простой заменой~$x_1$ на~$x_2$ по~всему тексту рода структуры), то~в~синтезированной теории будет выразимо и~отношение <<подчинения>>, и~отношение <<быть родителем>>. Также можно будет образовать принципиально новые термы, в~которых используются оба эти отношения. Например, терм <<множество подчинённых, которые являются детьми своего начальника>>.

Таким образом, в~синтезированном роде структуры (если такой можно построить) появляется возможность выводить термы и~формулировать утверждения, невыразимые в~синтезируемых родах структур.

Теперь перейдём к~формальному определению. Пусть даны

\begin{enumerate}
	\item род структуры~$\Sigma$ (который будем называть конкретизируемым родом структуры) с~выделенными в~нём~$p$ базисными множествами. Без ограничения общности можно считать, что~$\Sigma$ построен на~$n$ базисных множествах $x_1,\ldots x_n$, из~которых выделены~$p$ первых~$x_1,$\ldots $x_p$, $p \le n$, и~имеет родовую константу~$d_\Sigma$, типовую характеристику~$T_\Sigma$ вида $d_\Sigma \in S_\Sigma[x_1,\ldots x_n]$ и~аксиому~$R_\Sigma$;
 \item род структуры~$\Theta$ (который будем называть конкретизирующим родом структуры) с~выделенными в~нём~$p$ внутренними термами\footnote{\,Напомним, что биективно переносимый при типовой характеристике рода структуры~$\Sigma$ терм называется внутренним, если не~содержит никаких параметров, кроме, возможно, базисных множеств и~родовой константы~$\Sigma$.}~$\psi_1,$\ldots $\psi_p$ с~типами $\parts(S_1),\ldots \parts(S_p)$, причём не~исключается случай, когда любой из~$\psi_i$ совпадает либо с~базисным множеством~$\Theta$, либо с~родовой константой~$\Theta$. Без ограничения общности можно считать, что~$\Theta$ построен на~$m$ базисных множествах $x_{n + 1},\ldots x_{n+m}$ и~имеет родовую константу~$d_\Theta$, типовую характеристику~$T_\Theta$ вида $d_\Theta \in S_\Theta[x_{n + 1},\ldots x_{n+m}]$ и~аксиому~$R_\Theta$.
\end{enumerate}

В этом случае мы~будем говорить, что~$\Sigma$ и~$\Theta$ удовлетворяют условиям синтеза.

Рассмотрим класс
\[\begin{array}{l}\tilde {\mathcal K} = \{ (x_1, \ldots x_n, d_\Sigma, x_{n +1},\ldots x_{n + m}, d_\Theta)\mid \\
\quad \quad (T_\Sigma\&R_\Sigma\&T_\Theta\&R_\Theta\& (\psi_1 = x_1) \&\ldots\&(\psi_p=x_p))\}.\end{array}\]

Это есть интересующий нас класс пар вида <<$\Sigma$-объект, $\Theta$-объект>>, таких, что базисные множества $x_1,\ldots x_p$ рода структуры~$\Sigma$ тождественны термам $\psi_1,\ldots \psi_p$ рода структуры~$\Theta$. Но~коль скоро термы $\psi_1,\ldots \psi_p$ могут быть вычислены при данных $x_{n +1},\ldots x_{n + m}, d_\Theta$, то~каждому элементу $\tilde {\mathcal K}$ можно поставить во~взаимно однозначное соответствие элемент класса
\[\begin{array}{l}\mathcal K_{\tilde\Sigma} = \{ (x_{p+1}, \ldots x_n, d_\Sigma, x_{n +1},\ldots x_{n + m}, d_\Theta)\mid \\
\quad \quad (\psi_1\mid x_1)\ldots(\psi_p\mid x_p) (T_\Sigma\&R_\Sigma\&T_\Theta\&R_\Theta)\}.\end{array}\]

Если $(\xi_1, \ldots \xi_n, \delta_\Sigma, \xi_{n +1},\ldots \xi_{n + m}, \delta_\Theta) \in \tilde {\mathcal K}$, то~отбрасывание из~этого кортежа компонентов $\xi_1,\ldots \xi_p$ даёт в~силу свойств равенства (теорема~\ref{theor:equality}) элемент класса $K_{\tilde\Sigma}$; если же~дан элемент $(\xi_{p+1}, \ldots \xi_n, \delta_\Sigma, \xi_{n +1},\ldots \xi_{n + m}, \delta_\Theta) \in K_{\tilde\Sigma}$, то~добавление компонентов $(\xi_{n +1}\mid x_{n+1})\ldots (\xi_{n +m}\mid x_{n+m})(\delta_\Theta \mid d_\Theta)\psi_i$, $i = 1,\ldots p$ в~качестве первых~$p$ множеств~$\xi_i$ даёт, опять же~в~силу свойств равенства, элемент класса $\tilde {\mathcal K}$.

В определении класса $\mathcal K_{\tilde\Sigma}$ отсутствуют не~переносимые биективно условия $(\psi_1 = x_1) \&\ldots\&(\psi_p=x_p)$, и~этот класс, как мы~сейчас убедимся, является классом теоретико-множественных интерпретаций некоторого рода структуры $\tilde \Sigma$, который формально строится из~родов структур~$\Sigma$ и~$\Theta$ и~который мы~будем называть \emph{синтезированным родом структуры}.

Правила построения синтезированного рода структуры $\tilde \Sigma$:
\begin{enumerate}
	\item конкретизируемые множества~$x_1,$\ldots $x_p$ удаляются из~текста конкретизируемого рода структуры (их~место в~синтезированном роде структуры займут термы~$\psi_1,$\ldots $\psi_p$);
	\item тексты обоих родов структур объединяются в~один текст (предполагается, что имена всех конституэнт выбраны таким образом, что ни~одно имя конституэнты из~$\Sigma$ не~встречается среди имён конституэнт~$\Theta$); если в~текстах~$\Sigma$ и~$\Theta$ имеются совпадающие вспомогательные базисные множества, то~в~тексте $\tilde \Sigma$ оставляется одна копия;
 \item типовая характеристика~$T_\Sigma$ вида \[d_\Sigma \in S_\Sigma[x_1,\ldots x_p, x_{p+1},\ldots x_n]\] заменяется на~типовую характеристику~$\tilde T$ вида \[\tilde d \in S_\Sigma[S_1[x_{n+1},\ldots x_{n+m}],\ldots S_p[x_{n+1},\ldots x_{n+m}], x_{p+1},\ldots x_n]\] (напомним, что термы~$\psi_1,$\ldots $\psi_p$ имеют типы $\parts(S_1),\ldots \parts(S_p)$);
 \item во~всех прочих выражениях все вхождения букв~$x_1,$\ldots $x_p$ заменяются на~термы~$\psi_1,$\ldots $\psi_p$: мы~будем обозначать через~$\tilde R$ результат этой замены в~аксиоме~$R_\Sigma$; ясно, что выражения~$T_\Theta$ и~$R_\Theta$, не~содержащие~$x_1,$\ldots $x_p$ в~качестве параметров, в~синтезированную схему перейдут без изменений;
 \item добавляется \emph{аксиома синтеза} $R_S$ вида $(\psi_1\mid x_1)\ldots(\psi_p\mid x_p) T_\Sigma$.
\end{enumerate}

При этом мы~говорим, что множества~$x_1,$\ldots $x_p$ рода структуры~$\Sigma$ отождествляются с~термами~$\psi_1,$\ldots $\psi_p$ рода структуры~$\Theta$. Вновь заметим, что не~исключается случай, когда любой из~$\psi_i$ совпадает либо с~базисным множеством~$\Theta$, либо с~родовой константой~$\Theta$ (второе, правда, возможно лишь в~случае, когда $d_\Theta \in \parts (\ldots)$, т.~е. $d_\Theta$ имеет характер множества).


Рассмотрим теперь уже более развёрнуто ещё один пример синтеза: рода структуры функции с~родом структуры разбиения множества, где каждый элемент разбиения отождествляется с~аргументом функции.

\begin{itemize}
	\item Род структуры функции~$\Sigma$:
	
	 $x_1$, $x_2$;

 $d_\Sigma \in \parts (x_1\times x_2)$;

 $R_1: \forall u \in x_1, \exists v \in x_2 ((u, v) \in d_\Sigma)$;

 $R_2: \forall t_1\in d_\Sigma, \forall t_2 \in d_\Sigma (\pr_1(t_1) = \pr_1(t_2) \imp t_1 = t_2)$.

 \item Род структуры разбиения множества~$\Theta$:

 $x_3$;

 $d_\Theta \in \parts\parts(x_3)$;

 $R_3: \forall u\in x_3,\exists g\in d_\Theta(u\in g)$;

 $R_4: \forall g_1\in d_\Theta,\forall g_2\in d_\Theta ((g_1 = g_2)\vee (g_1\cap g_2=\varnothing))$.

 \item Род структуры функции от~элементов разбиения $\tilde \Sigma$:

	 $x_2$, $x_3$;

 $\tilde d \in \parts (\parts(x_3)\times x_2)$;

 $d_\Theta \in \parts\parts(x_3)$;

 $\tilde R_1: \forall u \in d_\Theta, \exists v \in x_2 ((u, v) \in \tilde d)$;

 $\tilde R_2: \forall t_1\in \tilde d, \forall t_2 \in \tilde d (\pr_1(t_1) = \pr_1(t_2) \imp t_1 = t_2)$;

 $R_3: \forall u\in x_3,\exists g\in d_\Theta(u\in g)$;

 $R_4: \forall g_1\in d_\Theta,\forall g_2\in d_\Theta ((g_1 = g_2)\vee (g_1\cap g_2=\varnothing))$;

 $R_S: \tilde d \in \parts (d_\Theta\times x_2)$.
\end{itemize}

Может ли~каждый элемент первой большой проекции~$\tilde d$ быть любым подмножеством~$x_3$? Разумеется, нет: синтезируя~$\Sigma$ и~$\Theta$, мы~предполагаем, что каждый аргумент функции~$\tilde d$ является элементом разбиения~$d_\Theta$. Но~легко видеть, что сам по~себе этот факт не~есть теорема $\tilde \Sigma$, поэтому в~синтезированный род структуры добавляется аксиома синтеза~$R_S$. Заметим, что в~этом случае вкупе с~соотношением типизации для~$\tilde d_\Sigma$ аксиома синтеза эквивалентна утверждению $\Pr_1(\tilde d)\subseteq d_\Theta$.

Произведённые нами действия можно следующим образом проиллюстрировать на~M-графах:
\[
\begin{xy}
\POS(0,-20)*{x_3}*\cir<5mm>{}
\ar(0,0)*\cir<5mm>{}
\POS(0,0)*i\cir<5mm>{}
\ar(0,20)*\cir<5mm>{}
\POS(-1.5,20.5)*-{\bullet};(-1.5,29.5)*{d_\Theta}**@{.}
\POS(-1.5,1.5)*-{\bullet};(-12,5.5)*{t \in d_\Theta}**@{.}
\end{xy}
+
\begin{xy}
\POS(0,0)*{x_1}*\cir<5mm>{}
\ar(15,19)*\cir<5mm>{}|1
\POS(15,19)*i\cir<5mm>{}
\ar(15,40)*\cir<5mm>{}
\POS(30,0)*{x_2}*\cir<5mm>{}
\ar(15,19)*i\cir<5mm>{}|2
\POS(16.5,41.5)*-{\bullet};(28,41.5)*{d_\Sigma}**@{.}
\POS(0,-3)*-{\bullet};(12,-5)*{u \in x_1}**@{.}
\end{xy}
=
\begin{xy}
\POS(0,0)*\cir<5mm>{}
\ar(15,19)*\cir<5mm>{}|1
\POS(15,19)*i\cir<5mm>{}
\ar(15,40)*\cir<5mm>{}
\POS(30,0)*{x_2}*\cir<5mm>{}
\ar(15,19)*i\cir<5mm>{}|2
\POS(0,0)*i\cir<5mm>{}
\ar(0,19)*\cir<5mm>{}
\POS(0,-19)*{x_3}*\cir<5mm>{}
\ar(0,0)*i\cir<5mm>{}
\POS(-1.5,20.5)*-{\bullet};(-1.5,29.5)*{d_\Theta}**@{.}
\POS(16.5,41.5)*-{\bullet};(28,41.5)*{\tilde d}**@{.}
\end{xy}
\]

\begin{exercise}Пусть базисное множество~$x_1$ отождествляется с~термом~$\psi$. Проверьте, что при типовых характеристиках
	1\rp~$d \in x_1$,
	2\rp~$d \in x_1\times x_2$,
	3\rp~$d \in \parts (x_1\times x_2)$,
	4\rp~$d \in \parts \parts (x_1\times x_1)$,
	5\rp~$d \in \parts \parts \parts (x_1\times x_2)$,
	6\rp~$d \in \parts ((x_1\times x_2) \times x_1)$,
	7\rp~$d \in \parts (x_1) \times x_1\times x_2$, аксиомы синтеза вместе с~новым соотношением типизации будут эквивалентны соответственно
	1\rp~$d \in \psi$,
 2\rp~$\pr_1(d)\in \psi$,
 3\rp~$\Pr_1(d)\subseteq \psi$,
 4\rp~$\Pr_1(\bigcup d)\subseteq \psi \& \Pr_2(\bigcup d)\subseteq \psi$,
 5\rp~$\Pr_1(\bigcup\bigcup d)\subseteq \psi$,
 6\rp~$\Pr_1(\Pr_1(d))\subseteq \psi \& \Pr_2(d)\subseteq \psi$,
 7\rp~$\pr_1(d) \subseteq \psi \& \pr_2(d)\in \psi$.
\end{exercise}


\begin{theorem}\label{th:synthcorr} Пусть $\tilde \Sigma$~--- синтезированный из~$\Sigma$ и~$\Theta$ род структуры, $\mathcal K_{\tilde\Sigma}$~--- класс $\tilde \Sigma$-объектов. В~этом случае выполняется соотношение \[\begin{array}{l}\mathcal K_{\tilde\Sigma} = \{ (x_{p+1}, \ldots x_n, d_\Sigma, x_{n +1},\ldots x_{n + m}, d_\Theta)\mid \\ \quad \quad (\psi_1\mid x_1)\ldots(\psi_p\mid x_p) (T_\Sigma\&R_\Sigma\&T_\Theta\&R_\Theta)\}.\end{array}\]
\end{theorem}

(Как мы~помним, из~этого класса можно построить класс пар вида <<$\Sigma$-объект, $\Theta$-объект>>, таких, что базисные множества $x_1,\ldots x_p$ рода структуры~$\Sigma$ тождественны термам $\psi_1,\ldots \psi_p$ рода структуры~$\Theta$.)

\beginproof В~соответствии с~определениями операции синтеза и~класса теоретико-множественных интерпретаций
\[\begin{array}{l}\mathcal K_{\tilde\Sigma} = \{ (x_{p+1}, \ldots x_n, d_\Sigma, x_{n +1},\ldots x_{n + m}, d_\Theta)\mid \\
\quad \quad \tilde T \& T_\Theta \& R_\Theta\& (\psi_1\mid x_1)\ldots(\psi_p\mid x_p)(T_\Sigma \& R_\Sigma)\}.\end{array}\]

Здесь знаком~$\tilde T$ обозначено соотношение типизации, получаемое из~$T_\Sigma$ заменой всех вхождений букв~$x_1,$\ldots $x_p$ на~$S_1[\ldots],\ldots S_p[\ldots]$. Выражение $(\psi_1\mid x_1)\ldots(\psi_p\mid x_p)T_\Sigma$ соответствует аксиоме синтеза. Иначе говоря, требуется доказать, что \[\begin{array}{l}(\psi_1\mid x_1)\ldots(\psi_p\mid x_p) (T_\Sigma\&R_\Sigma\&T_\Theta\&R_\Theta)\sim\\ \quad \sim \tilde T \&T_\Theta\&R_\Theta\& (\psi_1\mid x_1)\ldots(\psi_p\mid x_p) (T_\Sigma \& R_\Sigma).\end{array}\]

Формула~$T_\Theta\&R_\Theta$, унаследованная из~конкретизирующего рода структуры, не~содержит в~качестве параметров букв~$x_1,$\ldots $x_p$, поэтому $(\psi_1\mid x_1)\ldots(\psi_p\mid x_p)(T_\Theta\&R_\Theta) \sim T_\Theta\&R_\Theta$, и~эту формулу вообще можно исключить из~рассмотрения, доказывая лишь, что\[\begin{array}{l}(\psi_1\mid x_1)\ldots(\psi_p\mid x_p) (T_\Sigma\&R_\Sigma)\sim\\
\quad \sim \tilde T \& (\psi_1\mid x_1)\ldots(\psi_p\mid x_p) (T_\Sigma \& R_\Sigma).\end{array}\]

Но для этого достаточно доказать, что \[\vdash (\psi_1\mid x_1)\ldots(\psi_p\mid x_p) T_\Sigma \imp \tilde T.\]

Напомним, что формула~$T_\Sigma$ имеет вид $d_\Sigma \in S_\Sigma[x_1,\ldots x_n]$, а~$\tilde T$~--- вид \[d_\Sigma \in S_\Sigma[S_1[x_{n+1},\ldots x_{n+m}],\ldots S_p[x_{n+1},\ldots x_{n+m}], x_{p+1},\ldots x_n],\] где $\parts S_i[x_{n+1},\ldots x_{n+m}]$~--- типизация терма~$\psi_i$, $i = 1,\ldots p$. Докажем $(\psi_1\mid x_1)\ldots(\psi_p\mid x_p) T_\Sigma \imp \tilde T$ индукцией по~построению схемы~$S_\Sigma$.

\begin{enumerate}
	\item Если~$S_\Sigma = i$, то~возможны два варианта. Случай~$i > p$ тривиален: замены нет и~$T_\Sigma$ и~$\tilde T$ есть одна и~та~же~формула. Если~$i \le p$, то~$u \in \psi_i \& \psi_i \in \parts S_i[x_{n+1},\ldots x_{n+m}] \imp u \in S_i[x_{n+1},\ldots x_{n+m}]$.
 \item Если $S_\Sigma = \parts(S^*)$, причём по~предположению индукции \[\begin{array}{l}(\psi_1\mid x_1)\ldots(\psi_p\mid x_p) (u \in S^*) \imp\\ \quad \imp u\in S^*[S_1[x_{n+1},\ldots x_{n+m}],\ldots\\ \quad\quad \ldots S_p[x_{n+1},\ldots x_{n+m}], x_{p+1},\ldots x_n],\end{array}\]	то с~учётом \[u \in \parts(S^*) \sim \forall t(t \in u \imp t \in S^*)\] имеем \[\begin{array}{l}(\psi_1\mid x_1)\ldots(\psi_p\mid x_p) (u \in \parts(S^*)) \imp\\ \quad \imp u \in \parts (S^*[S_1[x_{n+1},\ldots x_{n+m}],\ldots\\ \quad \quad \ldots S_p[x_{n+1},\ldots x_{n+m}], x_{p+1},\ldots x_n]).\end{array}\]
 \item Если $S_\Sigma = S^*_1 \times S^*_2$, то~\[u \in S^*_1[\ldots] \times S^*_2[\ldots] \imp \exists v \exists w (v \in S^*_1[\ldots] \& w \in S^*_2[\ldots] \& (v, w) = u),\] откуда с~использованием предположения индукции уже легко получить требуемое.\endproof
\end{enumerate}

\begin{exercise}Проверьте, что если~$F$~--- теорема~$\Sigma$, то~$(\psi_1\mid x_1)\ldots\linebreak[1]{(\psi_p\mid x_p)F}$~--- теорема $\tilde \Sigma$.\end{exercise}

\p[Критерий непротиворечивости.] Будет ли~построенный при помощи синтеза род структуры $\tilde\Sigma$ непротиворечивым? Легко видеть, что необходимым условием непротиворечивости синтезированного рода структуры является непротиворечивость синтезируемых родов структур.

Однако даже при синтезе непротиворечивых родов структур может образоваться противоречивый род структуры. Например, характер аксиом~$\Sigma$ может влечь бесконечность множества, соответствующего~$x_1$, в~любой теоретико-множественной интерпретации~$\Sigma$, а~терм~$\psi_1$ рода структуры~$\Theta$ может быть конечным в~любой теоретико-множественной интерпретации~$\Theta$. Ясно, что если попытаться отождествить~$x_1$ с~$\psi_1$, то~для синтезированного рода структуры не~найдётся теоретико-множественных интерпретаций, т.~е. он~будет противоречивым.

\begin{theorem}\label{th:synthcrit}Пусть~$\Sigma$~--- конкретизируемый, $\Theta$~--- конкретизирующий род структуры, причём множества~$x_1,$\ldots $x_p$ рода структуры~$\Sigma$ отождествляются с~термами~$\psi_1,$\ldots $\psi_p$ рода структуры~$\Theta$. Синтезированный род структуры $\tilde\Sigma$ непротиворечив тогда и~только тогда, когда одновременно выполнены следующие условия:

\begin{enumerate}
	\item существует~$\Sigma$-объект $\upsilon = (\xi_1,\ldots \xi_n, \delta_\Sigma)$;
	\item существует~$\Theta$-объект $\omega = (\xi_{n+1},\ldots \xi_{n+m}, \delta_\Theta)$;
	\item каждое из~множеств~$\xi_1,\ldots \xi_p$ равномощно соответствующему множеству \[\bar \psi_i = (\xi_{n+1}\mid x_{n + 1})\ldots (\xi_{n+m}\mid x_{n+m}) (\delta_\Theta \mid d_\Theta) \psi_i,\] где $i = 1\ldots p$, $p \le n$.
\end{enumerate}
\end{theorem}

Иначе говоря, род структуры, полученный синтезом, непротиворечив тогда и~только тогда, когда у~каждого из~синтезируемых родов структур имеется по~теоретико-множественной интерпретации, причём эти интерпретации таковы, что каждый терм, соответствующий конкретизируемому базисному множеству первого рода структуры, равномощен терму, соответствующему конкретизирующему терму второго рода структуры.

\beginproof В~одну сторону: пусть указанная пара объектов~$\upsilon$, $\omega$ существует. По~условию должны существовать биекции $\varphi_1: \xi_1 \leftrightarrow \bar \psi_1$, $\varphi_2: \xi_2 \leftrightarrow \bar \psi_2$\ldots $\varphi_p: \xi_p \leftrightarrow \bar \psi_p$ и~возможен перенос $\xi_1,\ldots \xi_p$ на~$\bar \psi_1,\ldots \bar \psi_p$ при типовой характеристике рода структуры~$\Sigma$ с~построением терма~$\tilde \delta$ из~терма $\delta_\Sigma$ при помощи канонического распространения. Покажем, что $\tilde \Sigma$-объектом является объект, построенный следующим образом:

\begin{enumerate}
	\item базисные множества, унаследованные из~$\Sigma$, интерпретируются термами~$\xi_{p+1},\ldots \xi_n$;
	\item базисные множества, унаследованные из~$\Theta$, интерпретируются термами~$\xi_{n+1},\ldots \xi_{n +m}$;
	\item множество, интерпретирующее родовую константу~$\tilde d$, получается из~$\delta_\Sigma$ переносом $\xi_1,\ldots \xi_p$ на~$\bar \psi_1,\ldots \bar \psi_p$ при типовой характеристике рода структуры~$\Sigma$;
	\item родовая константа, унаследованная из~$\Theta$, интерпретируется термом~$\delta_\Theta$.
\end{enumerate}

Поскольку~$\xi_{n+1}$,\ldots $\xi_{n+m}$ и~$\delta_\Theta$, составляющие~$\Theta$-объект~$\omega$, используются без изменений, то~переходящие без текстуальных изменений в~синтезированный род структуры соотношения~$T_\Theta \& R_\Theta$ продолжают выполняться. Аксиома~$R_\Sigma$ выполняется в~силу своей биективной переносимости, аксиома синтеза выполняется по~построению, типовая характеристика~$\tilde T$ синтезированного рода структуры выполняется в~силу \[\vdash (\psi_1\mid x_1)\ldots(\psi_p\mid x_p) T_\Sigma \imp \tilde T\] (см. доказательство теоремы~\ref{th:synthcorr}).

В обратную сторону: пусть имеется $\tilde \Sigma$-объект~$\zeta$. Тогда терм~$\omega$, полученный отбрасыванием из~$\zeta$ множеств, соответствующих базисным множествам и~родовой константе, унаследованным из~$\Sigma$, является~$\Theta$-объектом ($\tilde T \& T_\Theta \& R_\Theta\& (\psi_1\mid x_1)\ldots(\psi_p\mid x_p)(T_\Sigma \& R_\Sigma) \imp T_\Theta \& R_\Theta$).

Пусть полученный таким образом объект~$\omega$ равен $(\xi_{n+1},\ldots \xi_{n+m}, \delta_\Theta)$, а~$\bar \psi_i = (\xi_{n+1}\mid x_{n + 1})\ldots (\xi_{n+m}\mid x_{n+m}) (\delta_\Theta \mid d_\Theta) \psi_i$, $i = 1\ldots p$. Терм~$\upsilon$, полученный из~$\zeta$ использованием
\begin{enumerate}
	\item $\bar \psi_1,\ldots \bar \psi_p$ для интерпретации первых~$p$ базисных множеств;
	\item множеств, интерпретирующих унаследованные из~$\Sigma$, для интерпретации базисных множеств с~номерами $p+1\ldots n$;
	\item множества, интерпретирующего синтезированную родовую константу, для интерпретации родовой константы~$d_\Sigma$,
\end{enumerate}
есть~$\Sigma$-объект. Первые~$p$ множеств этого~$\Sigma$-объекта совпадают по~построению с~термами $\bar \psi_1,\ldots \bar \psi_p$, следовательно, они равномощны этим термам.\endproof