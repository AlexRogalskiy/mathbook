\section[Типизации и~биективная переносимость]{Типизации и~биективная переносимость}
\label{sec:Scales}

\p \emph{Схема конструкции ступени} (по~Павловскому~\cite{Pavlovsk98, Pavlovsk03}) есть выражение, определяемое следующим образом:
\begin{enumerate}
	\item индекс\footnote{\,\emph{Индексом} мы~называем строку вида $\mid \mid \mid \ldots\mid$ ($n$ палочек), для краткости всюду заменяемую соответствующим натуральным числом~$n$. Важно понимать, однако, что числа, изображающие индексы, не~имеют отношения к~натуральным числам, определённым в~\S\,\ref{sec:naturalnumbers}, и~являются всего лишь сокращающими знаками для строк из~соответствующего числа вертикальных палочек. Для определения индекса (в~отличие от~определения натурального числа) не~требуется никакой теории, что позволяет использовать их~в~схемах конструкций ступеней (и~в~именах индексированных переменных типа~$x_2$, $d_4$) ещё прежде разговора о~любой теории.} есть схема конструкции ступени;
	\item если~$S$~--- схема конструкции ступени, то~$\parts (S)$~--- схема конструкции ступени;
	\item если~$S$ и~$S'$~--- схемы конструкции ступени, то~$(S \times S')$~--- схема конструкции ступени;
	\item других схем конструкции ступени не~существует.
\end{enumerate}

Иногда вместо <<схема конструкции ступени>> говорят просто <<схема>>, если из~контекста ясно, что речь идёт о~схеме конструкции ступени. Если~$S$~--- схема, а~$n$~--- максимальный индекс, использованный при её построении, то~$S$ называется \emph{схемой конструкции ступени над~$n$ множествами}.

Примеры: $1$~--- схема над одним множеством; $2$, ${(1 \times 2)}$, ${\parts (\parts (2))}$ и~${\parts (1 \times \parts (2))}$~--- схемы над двумя множествами; ${\parts(3 \times 5)}$~--- схема над пятью множествами.

Как и~в~случае с~пропозициональными формулами (см. с.~\pageref{def:pareconomy}), внешние скобки на~каждом шаге построения схемы нужны для того, чтобы однозначным образом определять последовательность вычислений. Для удобства будем экономить скобки в~тех случаях, когда последовательность очевидна: прежде всего откажемся от~внешних скобок на~последнем шаге построения схемы (например, схему $(1 \times 2)$ будем записывать как~$1 \times 2$). Во-вторых, будем считать, что операция~$\times$ выполняется последовательно слева направо, т.~е. схемы вида $(1 \times 2) \times 3$ (но~не~$1 \times (2 \times 3)$) будем записывать как $1 \times 2 \times 3$.

\p Пусть дана схема~$S$ над~$n$ множествами и~не~менее чем~$n$ переменных $\vect \xi{n'}$, $n' \geq n$. Тогда терм, полученный заменой индексов в~схеме~$S$ на~буквы $\vect \xi{n'}$ с~соответствующими индексами, мы~будем называть \emph{ступенью, построенной по~схеме~$S$ над множествами $\vect \xi{n'}$} и~обозначать как $S[\vect \xi{n'}]$. Пример: если~$S$~--- схема $\parts (1 \times \parts (2))$, то~$S[x_1, x_2] = \parts (x_1 \times \parts (x_2))$ и~$S[y_1, y_2] = \parts (y_1 \times \parts (y_2))$.

\emph{Шкалой} над множествами~$\vect x{n}$ называется совокупность всех ступеней, которые можно построить по~какой-либо схеме над множествами~$\vect x{n}$. Иначе говоря, шкала над~$\vect x{n}$~--- это совокупность всех множеств, которые можно построить из~исходных множеств при помощи операций декартова произведения и~множества-степени. Шкала сама является множеством (причём счётным), т.~к. все её элементы можно перечислить при помощи рекурсии.

\p Наглядную иллюстрацию для понятий шкалы и~ступеней дают так называемые \emph{M-графы}. M-граф представляет собой геометрическую фигуру, состоящую из~вершин, соединённых дугами (рёбрами), причём для каждой дуги задано направление, пара вершин может быть соединена одной или более чем одной дугой, и~если последнее имеет место, то~дуги нумеруются.

Построим граф по~следующему алгоритму: изобразим множества~$\vect xk$ в~виде вершин; если~$A$~--- вершина, соответствующая ступени~$m$, то~для ступени~$\parts (m)$ достроим новую вершину M-графа, соединяя её дугой с~вершиной~$A$; если~$A_1$, $A_2$~--- вершины, соответствующие ступеням~$m_1$, $m_2$ (возможно, какие-то из~них~--- совпадающие), то~для ступени $m_1 \times m_2$ достроим новую вершину M-графа, соединяя её нумерованными дугами с~вершинами~$A_1$, $A_2$, причём номер каждой дуги соответствует позиции~$m_i$ в~декартовом произведении. Пример M-графа см. на~рис.~\ref{fig:5}, где вершина~$A$ соответствует ступени~$\parts(x_1)$, вершина~$B$~--- ступени $x_1\times x_2$ и~т.~д.

\begin{figure}[htb]
\[
 \xyoption{curve}
 \begin{xy}
 \POS(0,0)*{x_1}*\cir<5mm>{}
 \ar(15,19)*\cir<5mm>{}|1
 \POS(15,19)*i\cir<5mm>{}
 \ar(30,60)*\cir<5mm>{}|2
 \POS(30,0)*{x_2}*\cir<5mm>{}
 \ar(15,19)*i\cir<5mm>{}|2
 \POS(0,0)*i\cir<5mm>{}
 \ar(0,19)*\cir<5mm>{}
 \POS(45,0)*{x_3}*\cir<5mm>{}
 \ar @/l5mm/(45,19)*-\cir<5mm>{}|1
 \POS(45,0)*i\cir<5mm>{}
 \ar @/r5mm/(45,19)*-\cir<5mm>{}|2
 \POS(45,19)*\cir<5mm>{}
 \ar(45,40)*\cir<5mm>{}
 \POS(45,40)*\cir<5mm>{}
 \ar(30,60)*\cir<5mm>{}|1
 \POS(30,60)*\cir<5mm>{}
 \ar(15,80)*\cir<5mm>{}|2
 \POS(0,19)*\cir<5mm>{}
 \ar(15,80)*\cir<5mm>{}|1
 \POS(-8,19)*{A}
 \POS(23,19)*{B}
 \POS(53,19)*{C}
 \POS(53,40)*{D}
 \POS(38,60)*{E}
 \POS( 7,80)*{F}
 \end{xy}
\]
	\caption{Пример M-графа}
	\label{fig:5}
\end{figure}
\begin{exercise}Каким ступеням соответствуют вершины~$C$, $D$, $E$, $F$ M-графа на~рис.~\ref{fig:5}?\end{exercise}
\begin{exercise}Постройте M-графы ступеней, соответствующих следующим формулам:
\[\begin{array}{l}
\parts(x_1\times\parts\parts(x_1\times x_1)),\\
\parts(x_2\times x_1)\times\parts(x_2\times x_1),\\
\parts\parts(x_2)\times\parts(x_1)\times x_1,\\
x_1\times\parts(x_3)\times\parts\parts(x_2),\\
x_3\times\parts(\parts(x_3)\times x_2)\times x_1.
\end{array}\]
\end{exercise}

\p Формула вида $\xi \in S[\vect xn]$, где~$\xi$~--- произвольная переменная или терм, называется \emph{соотношением типизации} для переменной (терма) $\xi$. Если для~$\xi$ выполняется соотношение типизации, то~говорят также, что множество (переменная, терм) $\xi$ \emph{типизировано ступенью} $S[\vect xn]$ или \emph{имеет тип} $S[\vect xn]$.

Характерной особенностью типизированных множеств является наличие некоторой предсказуемой структуры их~элементов. Индукцией по~построению схемы легко показать, что типизированными множествами могут быть только

\begin{itemize}
	\item элементы множеств~$\vect xn$ (если соотношение типизации имеет вид $\xi \in x_i$), в~этом случае говорят, что~$\xi$ \emph{имеет характер элемента};
	\item кортежи, каждый компонент которых типизирован (если соотношение типизации имеет вид $\xi \in S_1[\vect xn]\times\ldots \times S_k[\vect xn]$), в~этом случае говорят, что~$\xi$ \emph{имеет характер кортежа};
	\item множества, каждый элемент которых типизирован (если соотношение типизации имеет вид $\xi \in \parts (S[\vect xn])$), в~этом случае говорят, что~$\xi$ \emph{имеет характер множества}.
\end{itemize}

Например, если $d \in x_1\times x_2$, то~$d$~--- это пара элементов: $(\ldots, \ldots )$. Если ${d \in \parts (x_1\times x_2)}$, то~$d$~--- это некоторое множество пар: $\{(\ldots , \ldots )$, $(\ldots , \ldots ),\ldots \}$. Если ${d \in \parts \parts (x_1\times x_2)}$, то~$d$~--- это множество множеств пар: $\{\{ (\ldots ,\ldots )$, $(\ldots , \ldots )\ldots \}$, $\{ (\ldots ,\ldots )$, $(\ldots , \ldots )\ldots \}, \ldots \}$. Если ${d \in \parts (x_1)\times \parts (x_2)}$, то~$d$~--- это пара множеств: $(\{\ldots \},\{\ldots \})$. Если ${d \in \parts (\parts (x_1)\times x_2)}$, то~$d$~--- это множество пар вида <<множество, элемент>>: $\{(\{\ldots \},\ldots )$, $(\{\ldots \},\ldots ),\ldots \}$, и~т.~д.

Таким образом, типизированное множество не~допускает, например, существования среди своих элементов <<вперемешку>> множеств и~кортежей или кортежей с~разным количеством компонент. Условие $\xi \in S[\vect xn]$ кажется существенным ограничением для~$\xi$, но, как показывает практика, одних только типизированных множеств вполне достаточно для описания средствами теории множеств математических объектов и~построения прикладных моделей.

\p Другой важной особенностью типизированного множества является тот факт, что в~ситуации, когда множества~$\vect xn$ подвергаются преобразованиям, типизированное множество $\xi \in S[\vect xn]$ может быть преобразовано вместе с~$\vect xn$ некоторым согласованным образом.

Пусть даны множества~$x$ и~$x'$, а~также функция $f: x \rightarrow x'$. Функция ${\hat \parts (f): \parts(x) \rightarrow \parts(x')}$, определённая по~формуле $\hat \parts (f) = \{(u, v) \in \parts(x) \times \parts(x') \mid f[u] = v\}$, называется \emph{каноническим распространением~$f$ на~множество частей}.

Пусть даны множества~$x_1$, $x_2$, $x'_1$, $x'_2$, а~также функции $f_1: x_1 \rightarrow x'_1$ и~$f_2: x_2 \rightarrow x'_2$. Функция $f_1 \hat \times f_2: x_1 \times x_2 \rightarrow x'_1 \times x'_2$, определённая по~формуле $f_1 \hat \times f_2 = \{((u,v),(u', v'))\in (x_1 \times x_2)\times(x'_1 \times x'_2)\mid f_1(u) = u'\& f_2(v) = v'\}$, называется \emph{каноническим распространением~$f_1$, $f_2$ на~декартово произведение}.


Пусть имеются множества~$\vect xn$, $\vect{x'}n$ и~функции~$\vect fn$, такие, что $f_i: x_i \rightarrow x'_i$, как показано на~диаграмме: \[\xymatrix {x_1\ar@{->}[d]^{f_1} & x_2\ar@{->}[d]^{f_2} &\ldots & x_n\ar@{->}[d]^{f_n}\\x'_1 & x'_2 & \ldots & x'_n}\]

Пусть также дана схема~$S$ над не~более чем~$n$ множествами.

Функция, получаемая из~схемы~$S$ заменой индексов $1, 2, 3\ldots$ на~буквы~$f_i$ с~соответствующими индексами, знаков~$\parts$ на~$\hat \parts$ и~знаков~$\times$ на~$\hat \times$, называется \emph{каноническим распространением~$\vect fn$ по~схеме~$S$}, обозначается ${\langle\vect fn \rangle}^S$ и~обладает свойством
\[{\langle\vect fn \rangle}^S: S[\vect xn] \rightarrow S[\vect {x'}n].\]

Например, если даны $f_1: x_1 \rightarrow x'_1$ и~$f_2: x_2 \rightarrow x'_2$, а~также схема $\parts (1 \times 2)$, то~можно построить по~этой схеме функцию $\hat \parts (f_1 \hat \times f_2): \parts (x_1 \times x_2) \rightarrow \parts (x'_1 \times x'_2)$.

Применение функции ${\langle\vect fn \rangle}^S$ к~типизированному множеству $d \in S[\vect xn]$ называется \emph{переносом} множества~$d$ с~помощью функций~$\vect fn$. В~соответствии с~данными нами определениями результат переноса будет являться типизированным множеством, причём \[{\langle\vect fn \rangle}^S(d) \in S[\vect {x'}n].\]

Например, если $d\in \parts (x_1 \times x_2)$ и~даны $f_1: x_1 \rightarrow x'_1$ и~$f_2: x_2 \rightarrow x'_2$, то~мы~можем получить $d' = \hat \parts (f_1 \hat \times f_2) (d)$, такую, что $d'\in \parts (x'_1 \times x'_2)$, при этом каждой паре $(u, v) \in d$ соответствует пара $(u', v') \in d'$, такая, что $u' = f_1(u)$ и~$v' = f_2(v)$.

\begin{theorem}\label{th:extentions}Справедливы следующие утверждения:
\begin{enumerate}
	\item если $f_i: x_i \rightarrow x'_i$, $f'_i: x'_i \rightarrow x''_i$ для $i = 1,\ldots n$, то~\[{\langle f'_1\circ f_1,\ldots f'_n\circ f_n \rangle}^S = {\langle\vect {f'}n \rangle}^S \circ {\langle\vect fn \rangle}^S;\]
	\item если все $f_i: x_i \rightarrow x'_i$~--- сюръекции (инъекции, биекции) для $i = 1,\ldots n$, то~${\langle\vect fn \rangle}^S$~--- сюръекция (инъекция, биекция);
	\item если $f_i: x_i \leftrightarrow x'_i$ для $i = 1,\ldots n$, то~\[{\left({\langle\vect fn \rangle}^S\right)}^{-1} = {\langle f^{-1}_1,\ldots f^{-1}_n \rangle}^S.\]\end{enumerate}
\end{theorem}

\beginproof Докажем первые два утверждения теоремы индукцией по~построению схемы~$S$.

Если~$S$ представляет собой индекс~$k$, то~${\langle f'_1\circ f_1,\ldots f'_n\circ f_n \rangle}^S = {\langle\vect {f'}n \rangle}^S \circ {\langle\vect fn \rangle}^S = f'_k \circ f_k$. При этом ${\langle\vect fn \rangle}^S = f_k$, сюръективность (инъективность, биективность) сохраняется.

Пусть~$S$ имеет вид $S_1 \times S_2$. Используя предположение индукции, заключаем, что ${\langle f'_1\circ f_1,\ldots f'_n\circ f_n \rangle}^{S_1\times S_2} = ({\langle\vect {f'}n \rangle}^{S_1} \circ {\langle\vect fn \rangle}^{S_1}) \hat \times ( {\langle\vect {f'}n \rangle}^{S_2} \circ {\langle\vect fn \rangle}^{S_2})$. Но~$(g_1 \circ h_1) \hat \times (g_2 \circ h_2) = (g_1 \hat \times g_2) \circ (h_1 \hat \times h_2)$, т.~к. $(g_1 \circ h_1) \hat \times (g_2 \circ h_2) ((u, v)) = (g_1(h_1(u)), g_2(h_2(v)))$, откуда ${\langle f'_1\circ f_1,\ldots f'_n\circ f_n \rangle}^{S_1\times S_2} = {\langle\vect {f'}n \rangle}^{S_1 \times S_2} \circ {\langle\vect fn \rangle}^{S_1 \times S_2}$. По~предположению индукции, ${\langle\vect fn \rangle}^{S_1}$ и~${\langle\vect fn \rangle}^{S_2}$~--- сюръекция (инъекция, биекция). Т.~к. $g \hat \times h$ сохраняет одновременную сюръективность (инъективность, биективность) $g$ и~$h$, функция ${\langle\vect fn \rangle}^{S_1 \times S_2} = {\langle\vect fn \rangle}^{S_1} \hat \times {\langle\vect fn \rangle}^{S_2}$ сюръективна (инъективна, биективна).

Пусть, наконец, $S$ имеет вид $\parts (S')$ и~${\langle f'_1\circ f_1,\ldots f'_n\circ f_n \rangle}^{\parts (S')} = \hat \parts ({\langle\vect {f'}n \rangle}^{S'} \circ {\langle\vect fn \rangle}^{S'})$. Но~$\hat \parts (g \circ h) = \hat \parts g \circ \hat \parts h$, т.~к. $\hat \parts (g \circ h)(u) = (g \circ h)[u] = g[h[u]]$, откуда ${\langle f'_1\circ f_1,\ldots f'_n\circ f_n \rangle}^{\parts (S')} = {\langle\vect {f'}n \rangle}^{\parts (S')} \circ {\langle\vect fn \rangle}^{\parts (S')}$. Т.~к. $\hat \parts (g)$ сохраняет сюръективность (биективность, инъективность) $g$, то~функция ${\langle\vect fn \rangle}^{\parts (S')} = \hat \parts ({\langle\vect fn \rangle}^{S'} )$ сюръективна (инъективна, биективна). Первое и~второе утверждения теоремы доказаны.

Докажем третье утверждение теоремы. Пусть~$\vect fn$~--- биекции. По~доказанному, ${\langle\vect fn \rangle}^S$ и~${\langle f^{-1}_1,\ldots f^{-1}_n \rangle}^S$~--- биекции и~\[{\langle\vect fn \rangle}^{S} \circ {\langle f^{-1}_1,\ldots f^{-1}_n \rangle}^{S} = \id_{S[\vect xn]},\] где~$\id_u$~--- тождественное отображение~$u$ в~$u$, ставящее в~соответствие каждому элементу~$u$ сам этот элемент. Отсюда следует, что ${{\langle f^{-1}_1,\ldots f^{-1}_n \rangle}^S = \left({\langle\vect fn \rangle}^S\right)}^{-1}$, что и~требовалось.\endproof

\p Напомним, что в~главе~\ref{chapter:logic} термин \emph{теория} был определён как совокупность замкнутых формул (аксиом) некоторой сигнатуры. Далее в~главе~\ref{chapter:sets} мы~рассмотрели сигнатуру с~единственным предикатным символом <<$\in$>> и~построили в~ней теорию множеств~ZFC. Мы~отметили также, что ZFC не~является единственной возможной теорией множеств: независимость аксиом выбора и~континуум-гипотезы от~остальных аксиом~ZF, возможность их~формулировки в~различных <<сильных>> и~<<слабых>> формах порождает большое количество вариантов того, что можно считать <<теорией множеств>>.

Для дальнейших построений будет несущественно, какой из~вариантов теории множеств выбрать. Для большей части построений этой главы существенной будет только выполнимость первых четырёх аксиом~ZF (экстенсиональности, множества-степени, множества-суммы и~схемы подстановки), которых, как мы~знаем, достаточно для того, чтобы ввести операции построения множества частей~$\parts (x)$ и~декартова произведения~$x \times y$. Для того чтобы наши рассуждения обрели максимальную общность, введём специальные соглашения.

С этого момента мы~будем обозначать теории каллиграфической буквой~$\mathcal T$ со~штрихами и~индексами. Будем говорить, что теория $\mathcal T'$ сильнее теории~$\mathcal T$, если все без исключения теоремы~$\mathcal T$ являются теоремами $\mathcal T'$. В~частности, любая теория сильнее себя самой, противоречивая теория сильнее любой теории, и~если $\mathcal T'$ получена добавлением новых аксиом к~$\mathcal T$, то~$\mathcal T'$ сильнее~$\mathcal T$.

\p Пусть фиксированы

\begin{itemize}
 \item теория множеств~$\mathcal T$,
	\item переменные~$\vect xn$, называемые \emph{основными базисными множествами};
	\item термы теории~$\mathcal T$ $\vect \theta m$, называемые \emph{вспомогательными базисными множествами};
	\item схема~$S$ не~более чем над~$n + m$ множествами и~соотношение типизации~$T$ вида $d \in S[\vect xn, \vect \theta m]$ (здесь и~далее предполагается, что при построении ступени по~схеме~$S$ индексы~$n + i$ в~выражении схемы заменяются на~множества~$\theta_i$, т.~е. $d$ есть элемент некоторой ступени, построенной на~множествах $\vect xn, \vect \theta m$), буква~$d$ будет называться \emph{родовой константой};
	\item переменные $\vect {x'}n$, переменные~$\vect fn$ и~соотношение переноса~$F$ вида \[f_1: x_1 \leftrightarrow x'_1 \& \ldots \& f_n: x_n \leftrightarrow x'_n\] (каждая~$f_i$ есть биекция между~$x_i$ и~$x'_i$).
\end{itemize}

Если значения переменных~$\vect xn$, $\vect {x'}n$, $\vect fn$ заданы (т.~е. приравнены некоторым термам теории $\mathcal T'$, совпадающей с~$\mathcal T$ или более сильной), причём $\mathcal T'
\vdash T\&F$, то~мы~можем построить множество $d' \in S[\vect {x'}n, \vect \theta m]$ следующим образом: \[d' = {\langle\vect fn, \id_{\theta_1},\ldots \id_{\theta_m} \rangle}^S(d),\] где $\id_{\theta_i}$~--- тождественное отображение~$\theta_i$ в~$\theta_i$.

\emph{Таким образом, мы~имеем дело с~процессом, в~котором основные базисные множества подвергаются преобразованиям при помощи биекций, вспомогательные базисные множества не~изменяются, а~типизированная переменная~$d$ преобразуется согласованным образом.}

Формула~$R$, возможно, содержащая в~качестве параметров переменные~$\vect xn$ и~переменную~$d$, называется \emph{биективно переносимой} (в~теории~$\mathcal T$ при типизации~$T$), если \[\mathcal T \vdash T \& F \imp (R \lequals (x'_1\mid x_1)\ldots(x'_n\mid x_n)(d'\mid d)R).\]

Терм~$\xi$, возможно, зависящий от~переменных~$\vect xn$ и~$d$, называется \emph{биективно переносимым} (в~теории~$\mathcal T$ при типизации~$T$), если имеется такая схема~$S_\xi$, что выполняются следующие два условия:

\begin{enumerate}
	\item $\mathcal T \vdash T\imp \xi \in S_\xi[\vect xn, \vect \theta m]$,
 \item $\mathcal T \vdash T \& F \imp (x'_1\mid x_1)\ldots(x'_n\mid x_n)(d'\mid d)\xi = {\langle\vect fn, \id_{\theta_1},\ldots \id_{\theta_m} \rangle}^{S_\xi}(\xi)$.
\end{enumerate}\pagebreak[2]

Примеры:
\begin{itemize}
	\item если~$T$ есть $d \in x_1 \times x_1$, то~соотношение $\pr_1(d) = \pr_2(d)$ биективно переносимо (пусть~$d = (u, v)$, тогда $d' = (f_1(u), f_1(v))$ и~$\pr_1(d) = \pr_2(d) \lequals \pr_1(d') = \pr_2(d')$);
	\item соотношение~$x_1 = x_2$ не~является биективно переносимым (пусть~$x_1 = x_2$, $x'_1 = x_1$, $f_1 = \id_{x_1}$, в~качестве~$x'_2$ возьмём любое равномощное~$x_2$, но~не~равное~$x_2$ множество и~получим $x'_1 \neq x'_2$);
	\item если~$T$ есть $d \in \parts (x_1)$, то~соотношение~$d = x_1$ биективно переносимо, а~соотношение~$d = x_2$ не~является биективно переносимым;
	\item терм $x_1\cup x_2$ не~является биективно переносимым (нарушается первое условие биективной переносимости термов);
	\item если~$T$ есть $d \in \parts (x_1) \times \parts (x_1)$, то~терм $\pr_1(d) \cup \pr_2(d)$ является биективно переносимым (с~типом $\parts (x_1)$).
	\item терм $\{t \in S_\xi[x_1,\ldots] \mid x_1 = x_2\}$ не~является биективно переносимым (выполняется первое условие: терм имеет типизацию $\parts (S_\xi[x_1,\ldots])$, но~нарушается второе условие биективной переносимости термов).
\end{itemize}


\p[Условия биективной переносимости.] Выявим некоторые достаточные условия биективной переносимости термов и~соотношений.
\begin{theorem}\label{th:cstsimple}Справедливы следующие утверждения:

\begin{itemize}
	\item если ни~одна из~букв~$\vect xn$, $d$ не~встречается в~соотношении~$R$, то~$R$ биективно переносимо;

 \item терм $\varnothing$ есть биективно переносимый терм типа $\parts S'[x_1,\ldots]$, какова бы~ни~была схема~$S'$;

 \item при типизации $d \in S[x_1,\ldots]$ $x_i$~--- биективно переносимые термы типа $\parts (x_i)$, $\theta_i$~--- биективно переносимые термы типа $\parts (\theta_i)$, $d$~--- биективно переносимый терм типа $S[x_1,\ldots]$;

 \item если~$R$ и~$R'$~--- биективно переносимые соотношения, то~же~верно и~для соотношений~$\neg R$, $R \vee R'$, $R \& R'$, $R \imp R'$, $R \lequals R'$.
\end{itemize}
\end{theorem}

\beginproof Эти условия вытекают непосредственно из~определений.\endproof

\begin{theorem}\label{th:cstineq} Справедливы следующие утверждения:
\begin{itemize}
	\item если~$\xi$~--- биективно переносимый терм типа $S_\xi[x_1,\ldots]$ и~$\eta$~--- биективно переносимый терм типа $\parts (S_\xi[x_1,\ldots])$, то~соотношение $\xi \in \eta$ биективно переносимо;
		\item если~$\xi$ и~$\eta$~--- биективно переносимые термы одного и~того же~типа $S_\xi[x_1,\ldots]$, то~соотношение~$\xi = \eta$ биективно переносимо.
\end{itemize}
\end{theorem}

\beginproof Пусть, для краткости, $f^{S_\xi} = {\langle\vect fn, \id_{\theta_1},\ldots \id_{\theta_m} \rangle}^{S_\xi}$. Докажем первое утверждение. По~условию,

\[\begin{array}{l}\mathcal T \vdash T \& F \imp (x'_1\mid x_1)\ldots(d'\mid d)\xi = f^{S_\xi}(\xi) \& \\ \quad \quad \quad \quad \& (x'_1\mid x_1)\ldots(d'\mid d)\eta = \hat \parts f^{S_\xi}(\eta). \end{array}\]

В силу свойств равенства
\[\begin{array}{l}\mathcal T \vdash T \& F \imp (x'_1\mid x_1)\ldots(d'\mid d)(\xi \in \eta) \lequals (f^{S_\xi}(\xi) \in \hat \parts f^{S_\xi}(\eta)).\end{array}\]

Но $\hat \parts f^{S_\xi}(\eta) = f^{S_\xi}[\eta]$, откуда $f^{S_\xi}(\xi) \in \hat \parts f^{S_\xi}(\eta) \sim f^{S_\xi}(\xi) \in f^{S_\xi}[\eta]$.

В силу теоремы~\ref{th:extentions}, поскольку все~$\vect fn$~--- биекции, $f^{S_\xi}$~--- также биекция, откуда следует $f^{S_\xi}(\xi) \in f^{S_\xi}[\eta] \sim \xi \in \eta$ и~биективная переносимость соотношения $\xi \in \eta$.

Второе утверждение теоремы доказывается аналогичным образом.\endproof

\begin{theorem}\label{th:cstprodparts}\sloppy Если термы~$\xi$ и~$\eta$~--- переносимые термы типов соответственно $\parts (S_\xi[x_1,\ldots])$ и~$\parts(S_\eta[x_1,\ldots])$, то~$\xi \times \eta$ есть переносимый терм типа $\parts(S_\xi[x_1,\ldots]\times S_\eta[x_1,\ldots])$ и~$\parts(\xi)$ есть переносимый терм типа $\parts \parts (S_\xi[x_1,\ldots])$.
\end{theorem}

Обратим внимание: существенно, чтобы~$\xi$ и~$\eta$ имели характер множеств.

\beginproof Докажем, что $(x'_1\mid x_1)\ldots(d'\mid d)(\xi \times \eta) = \hat \parts (f^{S_\xi} \hat \times f^{S_\eta}) (\xi \times \eta)$, для чего в~силу биективной переносимости и~характера~$\xi$ и~$\eta$ достаточно доказать, что $f^{S_\xi}[\xi] \times f^{S_\eta}[\eta] = f^{S_\xi} \hat \times f^{S_\eta}[\xi \times \eta]$.

Действительно, $t \in f^{S_\xi}[\xi] \times f^{S_\eta}[\eta]$ $\sim$ $\exists u \exists v (u \in f^{S_\xi}[\xi] \& v \in f^{S_\eta}[\eta] \& t = (u, v)) \sim \exists u \exists v (\exists z (z \in \xi \& f^{S_\xi}(z) = u) \& \exists w (w \in \eta \& f^{S_\eta}(w) = v) \& t = (u, v)) \sim \exists z \exists w ({z \in \xi} \& {w \in \eta} \& (f^{S_\xi}(z), f^{S_\eta}(w))=t) \sim t \in f^{S_\xi} \hat \times f^{S_\eta}[\xi \times \eta]$.

(Последний шаг выкладки выполнен с~учётом $(f^{S_\xi}(z), f^{S_\eta}(w)) = f^{S_\xi} \hat \times f^{S_\eta}((z, w))$.)

Докажем биективную переносимость терма $\parts(\xi)$.

$(x'_1\mid x_1)\ldots(d'\mid d)\parts (\xi) = \parts(f^{S_\xi}[\xi]) = \{t \mid t\subseteq f^{S_\xi}[\xi]\} = \{t \mid \exists u (u \subseteq \xi \& t= f^{S_\xi}[u])\} = \{t \mid \exists u (u \in \parts(\xi) \& t= \hat \parts f^{S_\xi}(u))\} = \hat \parts f^{S_\xi} [\parts (\xi)] = \hat \parts\hat \parts f^{S_\xi} (\parts (\xi))$.\endproof


\begin{theorem}\label{th:cstechelon}
	Для всякой схемы конструкции ступени~$S'$ терм $S'[\vect xn, \vect \theta m]$ есть биективно переносимый терм типа $\parts S'[\vect xn, \vect \theta m]$.
\end{theorem}

\beginproof Доказывается с~помощью теоремы~\ref{th:cstprodparts} индукцией по~построению~$S'$.\endproof

\begin{theorem}\label{th:cstselect} Пусть формула~$R$ (зависящая, возможно, от~$t$) удовлетворяет условию \[T\&F\&(t\in S_t[x_1,\ldots]) \imp (R \lequals (x'_1\mid x_1)\ldots(d'\mid d)(f^{S_t}(t)\mid t)R).\] Тогда терм $\{t \in S_t[x_1,\ldots] \mid R\}$ биективно переносим.
\end{theorem}

(Заметим, что условие, налагаемое теоремой на~$R$, по~сути ничего нового не~добавляет к~условию биективной переносимости: в~частности, ему удовлетворяют не~зависящие от~$t$ биективно переносимые соотношения и~соотношения, биективно переносимые при соотношении типизации $t\in S_t[x_1,\ldots]$.)

\beginproof Нам нужно доказать, что в предположениях теоремы \[\hat \parts f^{S_t}(\{t \in S_t[x_1,\ldots] \mid R\}) = (x'_1\mid x_1)\ldots(d'\mid d)\{t \in S_t[x_1,\ldots] \mid R\}.\]

Действительно: $f^{S_t}[\{t \in S_t[x_1,\ldots] \mid R\}] = \{t \mid \exists u (u \in S_t[x_1, \ldots] \& (u\mid t)R \& t = f^{S_t}(u))\} = \{t \mid \exists u (u \in S_t[x_1,\ldots] \& t = f^{S_t}(u)\& ((f^{S_t})^{-1}(t)\mid t)R)\} = \{t \in f^{S_t}[S[x_1,\ldots]] \mid ((f^{S_t})^{-1}(t)\mid t)R\}$.

К только что выведенному соотношению \[{f^{S_t}[\{t \in S_t[x_1,\ldots] \mid R\}]} =\{t \in f^{S_t}[S[x_1,\ldots]] \mid ((f^{S_t})^{-1}(t)\mid t)R\}\] можно прийти и~таким неформальным рассуждением: чтобы найти <<образ>> терма $\{t \in S_t[x_1,\ldots] \mid R\}$, мы~должны среди элементов множества $f^{S_t}[S_t[x_1,\ldots]]$ выбрать такие, чей <<прообраз>> удовлетворяет~$R$.

В силу установленной в~теореме~\ref{th:cstechelon} биективной переносимости терма $S_t[\vect xn,\vect \theta m]$, имеет место $f^{S_t}[S_t[x_1,\ldots]] = \hat \parts f^{S_t}(S_t[x_1,\ldots]) = (x'_1\mid x_1)\ldots(d'\mid d)S_t[x_1,\ldots]$, и~для доказательства $\hat \parts f^{S_t}(\{t \in S_t[x_1,\ldots] \mid R\}) = (x'_1\mid x_1)\ldots(d'\mid d)\{t \in S_t[x_1,\ldots] \mid R\}$ осталось установить, что \[((f^{S_t}(t))^{-1}\mid t)R \lequals (x'_1\mid x_1)\ldots(d'\mid d)R.\]

В силу свойства~$R$, заданного условием, $((f^{S_t})^{-1}(t)\mid t)R \lequals (x'_1\mid x_1)\ldots$ $(d'\mid d)(f^{S_t}((f^{S_t})^{-1}(t))\mid (f^{S_t})^{-1}(t))({(f^{S_t})^{-1}(t)\mid t})R$, но~результат подстановок в~правой части и~есть формула $({x'_1\mid x_1})\ldots\linebreak[1] (d'\mid d)R$.\endproof

\begin{theorem}\label{th:cstquant}Пусть формула~$R$ (зависящая, возможно, от~$t$) удовлетворяет условию \[T\&F\&(t\in S_t[x_1,\ldots]) \imp (R \lequals (x'_1\mid x_1)\ldots(d'\mid d)(f^{S_t}(t)\mid t)R).\] Тогда соотношения \[\begin{array}{l} \exists t (t \in S_t[\vect xn,\vect \theta m] \& R),\\ \forall t (t \in S_t[\vect xn,\vect \theta m] \imp R)\end{array}\] биективно переносимы.
\end{theorem}

\beginproof Терм $\xi = \{t \in S_t[x_1\ldots] \mid R\}$~--- биективно переносимый типа $\parts S[x_1, \ldots]$ (теорема~\ref{th:cstselect}). Первое соотношение эквивалентно $\neg (\xi = \varnothing)$, а~второе~--- $\xi = S_t[x_1\ldots]$. Из~уже установленных условий биективной переносимости (теоремы~\ref{th:cstsimple},~\ref{th:cstineq}) следует, что оба этих соотношения биективно переносимы.\endproof

Соотношения рассматриваемого в~теореме~\ref{th:cstquant} вида (называемые соотношениями с~\emph{ограниченными кванторами}) часто записывают в~сокращённом виде:
\[\begin{array}{l} \exists t \in S_t[x_1,\ldots] R \rightleftharpoons \exists t (t \in S_t[x_1,\ldots] \& R),\\ \forall t \in S_t[x_1,\ldots] R \rightleftharpoons \forall t (t \in S_t[x_1,\ldots] \imp R).\end{array}\]

Особое внимание следует обратить на~то, что для квантора существования используется конъюнкция, а~для квантора всеобщности~--- импликация. При таком определении ограниченных кванторов сохраняются законы де~Моргана:

\[\begin{array}{l} \neg \exists t \in S_t[x_1,\ldots] R \sim \forall t \in S_t[x_1,\ldots] \neg R,\\ \neg \forall t \in S_t[x_1,\ldots] R \sim \exists t \in S_t[x_1,\ldots] \neg R.\end{array}\]

Действительно, используя эквивалентность $A \imp B \sim \neg A \vee B$ и~законы де~Моргана, имеем $\neg \forall x (x \in S[\ldots] \imp R) \sim \exists x \neg (\neg x \in S[\ldots] \vee R) \sim {\exists x (x \in S[\ldots] \& \neg R)} \sim {\exists x \in S[\ldots] \neg R}$. Обратно, $\neg \exists x (x \in S[\ldots] \& R) \sim \forall x (\neg x \in S[\ldots] \vee \neg R) \sim \forall v (x \in S[\ldots] \imp \neg R) \sim \forall x \in S[\ldots] \neg R$.


\begin{theorem}\label{th:debool} Пусть~$\xi$~--- биективно переносимый терм типа $\parts (S_\xi[x_1,\ldots])$, такой, что в~$\mathcal T$ выводимо, что~$\xi$~--- одноэлементный терм, т.~е. $\mathcal T \vdash \forall x \forall y (x \in \xi \& y \in \xi \imp x= y)$. Тогда $\bigcup \xi$ (равный единственному элементу множества~$\xi$) есть биективно переносимый терм типа $S_\xi[x_1,\ldots]$.
\end{theorem}

\beginproof Действительно, $(x'_1\mid x_1)\ldots(d'\mid d)\bigcup \xi = \{u\mid \exists t (t \in f^{S_\xi}[\xi] \& u \in t)\} = \{u \mid \exists t (\exists v (v \in \xi \& t = f^{S_\xi}(v)) \& u \in t)\}$. Но, в~силу того, что~$\xi$~--- одноэлементное множество, $v\in \xi \lequals v = \bigcup \xi$ и~цепочка равенств продолжается следующим образом: $(x'_1\mid x_1)\ldots(d'\mid d)\bigcup \xi = \{u \mid \exists t(t = f^{S_\xi}(\bigcup \xi) \& u \in t)\} = \{u \mid u \in f^{S_\xi}(\bigcup \xi)\} = f^{S_\xi}(\bigcup \xi)$, что и~требовалось доказать.\endproof

Итак, если биективно переносимый терм~$\xi$ имеет тип $\parts (S_\xi)$, то~$\bigcup \xi$ биективно переносим, если~$\xi$ необходимо состоит из~одного элемента. Если~$\xi$ может состоять более чем из~одного элемента, то~$\bigcup \xi$ может быть и~не~переносим биективно (так обстоит, например, с~термом $\bigcup x_1$). Как мы~увидим далее, если биективно переносимый терм~$\xi$ имеет тип $\parts \parts (S_\xi)$, то~для биективной переносимости терма $\bigcup \xi$ не~требуется дополнительных условий.

\begin{theorem}\label{th:cstpr}Пусть~$\xi$~--- биективно переносимый терм типа $S_1[x_1,\ldots]\times S_2[x_1,\ldots]$. Тогда~$\pr_1(\xi)$ есть биективно переносимый терм типа $S_1[x_1,\ldots]$, $\pr_2(\xi)$~--- биективно переносимый терм типа $S_2[x_1,\ldots]$.
\end{theorem}

\beginproof Пусть~$t = (u,v)$. Тогда \[\begin{array}{l}(x'_1\mid x_1)\ldots(d'\mid d)\pr_1(t) = \pr_1(f^{S_1}\hat \times f^{S_2}((u, v))) =\\ \quad = \pr_1((f^{S_1}(u), f^{S_2}(v))) = f^{S_1}(u) = f^{S_1}(\pr_1(t)),\end{array}\] что и~требовалось.\endproof

\begin{exercise}\label{crit:tr1}
Пусть~$\xi$~--- биективно переносимый терм с~типом $\parts(S_\xi[x_1,\ldots])$. Введём сокращающие обозначения
\[\begin{array}{l} \exists t \in \xi R \rightleftharpoons \exists t \in S_\xi[x_1,\ldots] (t \in \xi \& R),\\ \forall t \in \xi R \rightleftharpoons \forall t \in S_\xi[x_1,\ldots] (t \in \xi \imp R).\end{array}\]
Докажите, что соотношения $\exists t \in \xi R$, $\forall t \in \xi R$ биективно переносимы.
\end{exercise}

\begin{exercise}\label{crit:tr2}
Пусть~$\xi$, $\eta$~--- биективно переносимые термы одного и~того же~типа $\parts (S_\xi)$. Докажите, что соотношения $\xi \subseteq \eta$, $\xi \subset \eta$ биективно переносимы.
\end{exercise}

%\begin{exercise}\label{crit:tr3}Пусть XXXXXXXXXXXXXXXXX. Введём сокращающие обозначения \[\begin{array}{l} \exists t \subseteq \xi R \rightleftharpoons \exists t \in \parts(S_\xi[x_1,\ldots]) (t \subseteq \xi \imp R),\\ \forall t \subseteq \xi R \rightleftharpoons \forall t \in \parts(S_xi[x_1,\ldots]) (t \subseteq \xi \imp R).\end{array}\] Докажите, что соотношения $\exists t \subseteq \xi R$, $\forall t \subseteq \xi R$ биективно переносимы (аналогично для знаков~$\subset$ вместо~$\subseteq$). \end{exercise}


\p Рекурсивный характер только что доказанных условий биективной переносимости термов и~соотношений позволяет доказывать биективную переносимость индукцией по~построению выражения терма или формулы. Подрезюмировав содержание теорем~\ref{th:cstsimple}--\ref{th:cstpr} в~едином списке, можно определить класс формул и~термов, биективно переносимых по~построению. Оказывается, что этот класс достаточно широк и~лишь некоторые, причём довольно необременительные, ограничения отделяют его от~класса всех формул и~термов теории множеств.

Для удобства введём следующие обозначения:
\begin{itemize}
	\item $\tau(\xi)$ обозначает ступень, которой типизирован терм~$\xi$, т.~е. выражение $\tau(\xi) = S_\xi[x_1,\ldots]$ означает, что $\mathcal T \vdash T \imp \xi \in S_\xi[x_1,\ldots]$.
	\item $DS$ обозначает схему конструкции ступени такую, что $\parts (DS)$ совпадает с~$S$. Разумеется, это определение имеет смысл только в~случае, когда~$S$ имеет вид~$\parts(S')$ (и~тогда~$DS$ есть~$S'$). Ситуация, в~которой~$DS$ не~определена, означает нарушение какого-либо из~условий биективной переносимости.
	\item $P_1S$ и~$P_2S$ обозначают схемы конструкции ступеней, такие, что $P_1S \times P_2S = S$. Разумеется, это определение имеет смысл только в~случае, когда~$S$ имеет вид $S_1 \times S_2$ (и~тогда~$P_1S$ и~$P_2S$ есть~$S_1$ и~$S_2$, соответственно). Ситуация, в~которой ступень~$P_1S$ или~$P_2S$ не~определена, означает нарушение какого-либо из~условий биективной переносимости.
\end{itemize}

Теоремы~\ref{th:cstsimple}--\ref{th:cstpr}, сформулированные с~использованием новых обозначений, гласят, в~частности, что если в~каждом из~перечисленных случаев результирующие типы определены, то:
\begin{enumerate}
 \item $\varnothing$ есть биективно переносимый терм типа $\parts(S'[x_1, \ldots])$, какова бы~ни~была схема~$S'$;
	\item базисные множества~$\vect xn$ есть биективно переносимые термы, $\tau (x_i) = \parts(x_i)$;
	\item вспомогательные множества $\vect \theta m$ есть биективно переносимые термы, $\tau (\theta_i) = \parts(\theta_i)$;
	\item родовая константа~$d$, для которой вводится соотношение типизации $d \in S[x_1,\ldots]$, есть биективно переносимый терм, $\tau (d) = S[x_1,\ldots]$;
 %\item ступень $S'[x_1, \ldots]$ есть биективно переносимый терм, $\tau S'[x_1, \ldots] = \parts(S'[x_1, \ldots])$;
 \item если~$R$, возможно, зависящее от~$t$, биективно переносимо в~случае, когда $\tau(t) = S_t[x_1, \ldots]$, то~$\{t \in S_t[x_1, \ldots] \mid R\}$~--- биективно переносимый терм, $\tau(\{t \in S_t[x_1, \ldots] \mid R\}) = \parts (S_t[x_1, \ldots])$.
 \item если~$\xi$~--- биективно переносимый терм, причём $\mathcal T \vdash \forall x \forall y (x \in \xi \& y \in \xi \imp x= y)$, то~$\bigcup \xi$ (равный единственному элементу множества~$\xi$) есть биективно переносимый терм и~$\tau(\bigcup \xi)= D\tau(\xi)$;
 \item если~$\xi$~--- биективно переносимый терм, то~$\pr_1(\xi)$ и~$\pr_2(\xi)$~--- биективно переносимые термы, $\tau(\pr_1(\xi)) = P_1\tau(\xi)$, $\tau(\pr_2(\xi)) = P_2\tau(\xi)$;
 \item если~$\xi$ и~$\eta$~--- биективно переносимые термы и~$\parts (\tau (\xi)) = \tau (\eta)$, то~$\xi \in \eta$~--- биективно переносимое соотношение;
 \item если~$\xi$ и~$\eta$~--- биективно переносимые термы и~$\tau (\xi) = \tau (\eta)$, то~$\xi = \eta$~--- биективно переносимое соотношение;
 \item если~$R$ и~$R'$~--- биективно переносимые соотношения, то~$\neg R$, $R \vee R'$, $R \& R'$, $R \imp R'$, $R \lequals R'$~--- биективно переносимые соотношения;
 \item если~$R$, возможно, зависящее от~$t$, биективно переносимо в~случае, когда $\tau(t)=S_t[x_1, \ldots]$, то~$\forall t \in S_t[x_1, \ldots] R$ и~${\exists t \in S_t[x_1, \ldots] R}$~--- биективно переносимые соотношения.
\end{enumerate}

Примеры биективно переносимых термов и~соотношений рассматриваемого вида:

\begin{enumerate}
	\item для случая $d \in \parts (x_1 \times x_2)$ соотношения
 \begin{enumerate}
 	 \item $\forall v \in x_2, \exists u \in x_1 \times x_2 (u \in d \& \pr_2(u) = v)$;
	 \item $\forall t_1\in x_1 \times x_2, \forall t_2 \in x_1 \times x_2 (t_1 \in d \& t_2 \in d \& \pr_1(t_1) = \pr_1(t_2) \imp t_1 = t_2)$;
 \end{enumerate}
	термы
 \begin{enumerate}
 \setcounter{enumii}{2}
	 \item $\{t \in x_1 \mid \exists u \in x_1 \times x_2 (u \in d \& \pr_1(u) = t)\}$;
	 \item $\{t \in \parts (x_1)\mid \exists u \in x_2\ t = \{a \in x_1 \mid \exists v \in x_1\times x_2 (v \in d \& \pr_1(v) = a \& \pr_2(v) = u)\}\}$;
 \end{enumerate}
	\item для случая $d \in \parts \parts (x_1)$ соотношения
 \begin{enumerate}
	 \item $\forall a \in \parts (x_1), \forall b \in \parts (x_1) (a \in d \& b \in d \imp \{t \in x_1 \mid t \in a \& t \in b\} \in d)$;
	 \item $\forall a \in \parts (x_1), \forall b \in \parts (x_1), \forall t \in x_1 ((t \in a \imp t \in b) \imp b \in d)$;
 \end{enumerate}
	термы
 \begin{enumerate}
 \setcounter{enumii}{2}
	 \item $\{t \in x_1 \mid \exists v \in \parts (x_1) (v \in d \& t \in v)\}$;
	 \item $\{t \in x_1 \times x_1 \mid {\exists v \in \parts (x_1) } (v \in d \& {\pr_1(t) \in v} \& {\pr_2(t) \in v}) \}$
	\end{enumerate}
\end{enumerate}
и так далее.

Как видим, в~отличие от~термов и~соотношений теории множеств общего вида, термы и~соотношения рассматриваемого вида удовлетворяют двум основным принципам. Во-первых, любой терм~--- сам по~себе или в~составе подформулы~--- имеет свой тип (что неудивительно, т.~к. наличие типа является необходимым условием биективной переносимости терма), тип связанных переменных декларируется (т.~е. недопустимы выражения вида $\forall x R$, $\{x \mid R\}$, а~только $\forall x \in S[x_1,\ldots] R$, $\{x\in S[x_1,\ldots] \mid R\}$). Во-вторых, действуют ограничивающие правила, предписывающие определённую типизацию термам, участвующим в~выражениях вида $\xi \in \eta$, $\xi = \eta$, $\bigcup \xi$, $\pr_i(\xi)$. Если эти принципы выполняются на~каждом шаге при построении выражения, то~выражение оказывается биективно переносимой формулой или термом.

\begin{exercise}Выделите подтермы в~выражениях примеров, приведённых выше, и~укажите их~тип.

Частичное решение: в~примере 1a $\tau(v) = x_2$, $\tau (u) = x_1\times x_2$, $\tau (d) = \parts(x_1 \times x_2)$, $\tau(\pr_2(u)) = x_2$; в~примере 1d $\tau (t) = \parts(x_1)$, $\tau(u) = x_2$, $\tau (a) = x_1$, $\tau (v) = x_1 \times x_2$, $\tau (d) = \parts(x_1 \times x_2)$, $\tau(\pr_1(v)) = x_1$, $\tau \pr_2(v) = x_2$, $\tau (\{a \in x_1 \mid \ldots \}) = \parts(x_1)$, $\tau(\{t \in \parts (x_1) \mid \ldots\}) = \parts \parts (x_1)$.
\end{exercise}


\p Приведённых выше условий биективной переносимости достаточно для того, чтобы распространить их~на~большинство стандартных разновидностей термов и~соотношений теории множеств. Для этого обычные знаки для соотношений и~термов должны быть переопределены как сокращающие обозначения для биективно переносимых соотношений и~термов, с~введением ограничений на~типизацию аргументов. Например, переопределим отношение <<$\subseteq$>> как

\[\xi \subseteq \eta \rightleftharpoons \forall t \in D\tau (\xi) (t\in \xi \imp t\in \eta).\]

Так определённое отношение~$\subseteq$ является биективно переносимым по~построению. Конструкция $t \in D\tau (\xi)$ в~ограничивающем выражении квантора обеспечивает совпадение типа связанной переменной~$t$ с~типом каждого элемента~$\xi$ и~правомерность (с~точки зрения условий биективной переносимости) записи~$t\in \xi$ в~логическом выражении. Какие ограничения на~$\xi$ и~$\eta$ накладывает эта формула? Прежде всего отношение $\xi \subseteq \eta$ допустимо не~на~всех термах, а~только на~тех, у~которых совпадает типизация. Это следует из~того, что отношение <<$\in$>> применяется в~двух случаях: $t\in \xi$ и~$t\in \eta$, но~переменная~$t$ имеет одну и~ту~же~типизацию. Далее применение $D\tau (\xi)$ предполагает, что оба терма должны иметь характер множеств. Последнее условие интуитивно можно трактовать следующим образом: использование знака <<$\subseteq$>> бессмысленно между элементами или кортежами, а~имеет смысл только между множествами. Если указанные условия выполняются, <<биективно переносимый вариант>> отношения <<$\subseteq$>> имеет тот же~смысл, что и~обычное отношение <<$\subseteq$>> в~теории множеств.

Обобщение ограниченных кванторов:

\quad $\forall x \in \xi R \rightleftharpoons \forall x \in D\tau (\xi) (x \in \xi \imp R)$,

\quad $\exists x \in \xi R \rightleftharpoons \exists x \in D\tau (\xi) (x \in \xi \& R)$,

\quad $\forall x \subseteq \xi R \rightleftharpoons \forall x \in \tau (\xi) (x \subseteq \xi \imp R)$,

\quad $\exists x \subseteq \xi R \rightleftharpoons \exists x \in \tau (\xi) (x \subseteq \xi \& R)$.


Для знаков <<$\subset$>> определения аналогичные.

\p Определим биективно переносимые варианты некоторых из~операций над термами, введённых в~\S\,\ref{sec:thermoper}.

\begin{itemize}
	\item Синглетон: \[\{\xi\} \rightleftharpoons \{x \in \tau (\xi) | (x = \xi)\}, \quad \tau (\{\xi\}) = \parts( \tau(\xi)).\]
\end{itemize}

Для биективной переносимости~$\{\xi\}$ достаточно биективной переносимости~$\xi$, на~вид типизирующей терм~$\xi$ ступени не~накладывается никаких ограничений.

\begin{itemize}
	\item Множество-сумма:\[\bigcup\xi \rightleftharpoons \{x \in DD\tau (\xi) | \exists u \in \xi (x \in u)\},\] \[\tau (\bigcup\xi) = \parts( DD\tau (\xi)).\]
\end{itemize}

\[
\begin{xy}
\POS(0,0)*\cir<5mm>{}
\ar(0,20)*\cir<5mm>{}
\POS(0,20)*i\cir<5mm>{}
\ar(0,40)*\cir<5mm>{}
\POS(1.5,1.5)*-{\bullet};(17,1.5)*{\; x\in \bigcup\xi}**@{.}
\POS(1.5,21.5)*-{\bullet};(17,21.5)*{\; \bigcup\xi}**@{.}
\POS(1.5,41.5)*-{\bullet};(17,41.5)*{\; \xi}**@{.}
\end{xy}
\]

На диаграмме показана <<верхушка>> М-графа для ступеней, типизирующих термы~$\xi$, $\bigcup \xi$ и~связанную переменную~$x$, фигурирующую в~определении $\bigcup \xi$.

Таким образом, множество-сумма, образованное от~биективно переносимого терма с~типом $\parts\parts(S[x_1,\ldots])$, биективно переносимо (для случая типизации $\parts(S[x_1,\ldots])$ см. теорему~\ref{th:debool}).

Выражение $\parts( DD\tau (\xi))$ не~сокращается до~$D\tau(\xi)$, поскольку иначе потеряется ограничение на~типизацию аргумента ($D\tau(\xi)$ определена и~для типов $\parts(S[x_1,\ldots])$, не~только $\parts\parts(S[x_1,\ldots])$). Общее правило таково: допустимо сокращать конфигурацию~$D\parts$ (т.~к. она всюду применима и~тождественна), но~недопустимо сокращать конфигурацию~$\parts D$ (т.~к. она, хотя и~является тождественной, применима только для ступеней вида $\parts(S[x_1,\ldots])$). На~M-графе видно, что при построении выражения необходимо <<спускаться>> на~два шага вниз.


\begin{exercise}Докажите, что \[\tau(\underbrace{\bigcup\ldots\bigcup}_{n\;\hbox{\small раз}}(\xi)) = \parts (D^{n+1}\tau (\xi)).\]\end{exercise}

\begin{itemize}
	\item Объединение, пересечение, дополнение и~симметрическая разность: \[\xi\cup \eta \rightleftharpoons \{x \in D \tau(\xi) | (x \in \xi) \vee (x \in \eta)\},\] \[\xi\cap \eta \rightleftharpoons \{x \in D \tau(\xi) | (x \in \xi) \& (x \in \eta)\},\] \[\xi\setminus \eta \rightleftharpoons \{x \in D \tau(\xi) | (x \in \xi) \& (x \notin \eta )\},\] \[\xi\bigtriangleup \eta \rightleftharpoons \{x \in D \tau(\xi) | (x \in \xi) \oplus (x \in \eta )\},\] \[\begin{array}{l}\tau (\xi\cup \eta) =\tau (\xi\cap \eta)=\\ =\tau (\xi\setminus \eta) =\tau (\xi\bigtriangleup \eta) =\\\quad =\parts( D(\tau(\xi))) = \parts( D(\tau(\eta))).\end{array}\]
\end{itemize}

Для биективной переносимости этих термов требуется, чтобы биективно переносимые аргументы имели характер множеств и~были \emph{одинаково типизированы}. Совпадения типов требуют логические условия в~выражениях: например, в~выражении для $\xi\cup \eta$ связанная переменная имеет тип $D \tau(\xi)$ и, чтобы подформула~$x \in \eta$ также была биективно переносимой, требуется $\tau (\xi) = \tau (\eta)$.

\begin{itemize}
	\item Дополнение множества относительно собственного типа: \[\complement \xi \rightleftharpoons \{x \in D\tau (\xi) | \neg(x \in \xi)\},\] \[\tau(\complement \xi) = \parts( D\tau(\xi)).\]
\end{itemize}


\begin{itemize}
	\item Неупорядоченная пара: \[\{\xi, \eta \} \rightleftharpoons \{\xi\} \cup \{\eta\},\] \[\tau (\{\xi, \eta \}) = \parts (D \parts (\xi)) =\parts (\xi) = \parts (\eta).\]
\end{itemize}

Здесь вновь требуется совпадение типов~$\xi$ и~$\eta$.
\begin{itemize}
	\item Упорядоченная пара: \[(\xi, \eta) = \bigcup (\{x \in \tau (\xi) \times \tau (\eta)|(\pr_1(x) = \xi)\&(\pr_2(x) = \eta)\}),\] \[\tau ((\xi, \eta)) = \tau(\xi) \times \tau (\eta).\]
\end{itemize}

\begin{itemize}
	\item Декартово произведение: \[\xi\times \eta \rightleftharpoons \{x \in D\tau (\xi) \times D\tau (\eta) \mid (\pr_1(x) \in \xi) \& (\pr_2(x) \in \eta)\},\] \[\tau (\xi\times \eta) = \parts( D\tau (\xi) \times D\tau (\eta)).\]
\end{itemize}

Заметим, что, в~отличие от~упорядоченной пары, биективно переносимой при как угодно типизированных~$\xi$ и~$\eta$, декартово произведение биективно переносимо для термов, имеющих характер множеств.

\begin{itemize}
	\item Множество-степень: \[\parts (\xi) \rightleftharpoons \{x \in \tau (\xi) | (x \subseteq \xi)\},\] \[\tau (\parts (\xi)) = \parts( \parts( D\tau (\xi))).\]
\end{itemize}

\[
\begin{xy}
\POS(0,0)*\cir<5mm>{}
\ar(0,20)*\cir<5mm>{}
\POS(0,20)*i\cir<5mm>{}
\ar(0,40)*\cir<5mm>{}
\POS(1.5,1.5)*-{\bullet};(17,1.5)*{\; t\in \xi}**@{.}
\POS(1.5,21.5)*-{\bullet};(17,21.5)*{\; \xi}**@{.}
\POS(1.5,41.5)*-{\bullet};(17,41.5)*{\; \parts (\xi)}**@{.}
\end{xy}
\]

Сравните определение биективно переносимого множества-степени с~определением биективно переносимого синглетона, а~также выражения для их~типов. Использование в~выражении множества-степени знака~<<$\subseteq$>> неявно задействует определение $(\xi \subseteq \eta) \rightleftharpoons \forall t \in D\tau (\xi) (t\in \xi \imp t\in \eta)$, предполагающее <<спуск на~ступень вниз>> по~M-графу, что и~приводит к~другому выражению для типа~$\parts(\xi)$ и~другим требованиям к~типизации аргумента. В~отличие от~операции образования синглетона, которую можно применять к~как угодно типизированному терму, операция~$\parts$ допустима только для термов, имеющих характер множества.

\begin{itemize}
	\item Большая проекция: \[\Pr_i(\xi) \rightleftharpoons \{x \in P_i D\tau (\xi) | \exists y \in \xi (x = \pr_i (y))\},\] \[\tau (\Pr_i(\xi))= \parts( P_i D\tau (\xi)).\]
\end{itemize}

Для биективной переносимости терма~$\Pr_i(\xi)$ достаточно, чтобы терм~$\xi$ был биективно переносимым термом и~выражение $P_i D\tau (\xi)$ было определено, т.~е. чтобы~$\xi$ был типизирован ступенью $\parts (S_1[x_1,\ldots]\times S_2[x_1,\ldots])$.

Для того, чтобы <<добраться>> до~типизации \emph{элемента} $\Pr_i(\xi)$, необходимо сначала получить~$ D\tau (\xi)$~--- типизацию элемента~$\xi$ (а~каждый элемент~$\xi$ есть кортеж), затем~--- $P_i D\tau (\xi)$, т.~е. типизацию~$i$-го компонента элемента~$\xi$. Наконец, множество элементов, типизированных $P_i D\tau (\xi)$, будет иметь тип $\parts (P_i D\tau (\xi))$, как показано на~M-графе:

\[
\begin{xy}
\POS(0,0)*\cir<5mm>{}
\ar(15,19)*\cir<5mm>{}
\POS(15,19)*i\cir<5mm>{}
\ar(15,40)*\cir<5mm>{}
\POS(30,0)*\cir<5mm>{}
\ar(15,19)*i\cir<5mm>{}
\POS(0,0)*i\cir<5mm>{}
\ar(0,19)*\cir<5mm>{}
\POS(-1.5,1.5)*-{\bullet};(-17,1.5)*{x \in \Pr_1(\xi)}**@{.}
\POS(-1.5,20.5)*-{\bullet};(-17,20.5)*{\Pr_1(\xi)}**@{.}
\POS(13.5,41.5)*-{\bullet};(0,41.5)*{\xi}**@{.}
\POS(16.5,20.5)*-{\bullet};(30,20.5)*{\; y \in \xi}**@{.}
\end{xy}
\]

\begin{exercise}На~с.~\pageref{def:setpower} определена операция~$\xi^\eta$, представляющая собой множество всевозможных отображений из~$\eta$ в~$\xi$. При каких условиях эта операция является биективно переносимой и~какова её результирующая типизация? (Ответ: $\xi$ и~$\eta$ должны иметь характер множеств, $\tau(\xi^\eta) = \parts \parts (D\tau (\eta) \times D \tau (\xi))$.)\end{exercise}