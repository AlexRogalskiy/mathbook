\section{Исчисление предикатов}\label{sec:predcalculus}

\p В~этом параграфе мы, по~аналогии с~проделанным в~\S\,\ref{sec:Prop}, построим исчисление, позволяющее выводить все тавтологии языка логики предикатов (и~только их) из~аксиом при помощи правил вывода. Основным результатом, как и~тогда, станет доказательство эквивалентности понятия общезначимости формулы и~её выводимости в~построенном исчислении.

Прежде, однако, обсудим один принципиальный вопрос.

Доказуемость формулы исчисления высказываний эквивалентна её общезначимости, то~же~самое (как будет доказано ниже) имеет место для исчисления предикатов. Чтобы проверить, является ли~тавтологией формула алгебры высказываний, достаточно подставить в~неё все возможные комбинации переменных. Эту работу можно <<поручить>>, например, компьютеру, который за~конечное (хотя, может быть, и~большое) время гарантированно выдаст ответ. Можно ли~нечто подобное придумать для формул логики предикатов? Т.~е. возможно ли~<<раз и~навсегда>> построить такой алгоритм, подавая на~вход которого произвольную формулу произвольной сигнатуры, мы~гарантированно получали бы~на~выходе ответ на~вопрос: является ли~эта формула выполнимой? (В~этом случае можно было бы~определять и~общезначимость, для чего достаточно было бы~проверить выполнимость~$A$ и~$\neg A$.)

Ответ на~этот вопрос~--- отрицательный: в~общем виде такого алгоритма не~существует. Соответствующая теорема была доказана Чёрчем\indChurch\ в~1936~г. (см. напр.~\cite{Kleene05}). Алгоритмы можно предложить лишь для некоторых очень ограниченных классов сигнатур: к~примеру, если в~сигнатуре содержатся только нуль-местные предикатные символы, то~задача сводится к~алгебре высказываний (кванторы в~этом случае роли играть не~будут). Алгоритмически разрешимым является также вопрос и~о~выполнимости формулы в~сигнатуре, состоящей только из~одноместных предикатных символов.

\begin{exercise}\cite{VereShen2}. Пусть сигнатура состоит из~$n$ одноместных предикатных символов. Докажите, что если формула такой сигнатуры выполнима, то~она также выполнима в~некоторой модели с~множеством, состоящим из~$2^n$ элементов. Придумайте на~основании этого алгоритм установления выполнимости формулы данной сигнатуры.\end{exercise}

\emph{Не имея возможности в~общем случае установить общезначимость формулы алгоритмическим путём, мы тем не~менее всегда можем алгоритмически проверить корректность вывода формулы, если таковой предоставлен.}

\p Для построения исчисления предикатов естественно взять десять схем аксиом и~правило modus ponens исчисления высказываний (см. \S\,\ref{sec:Prop}), применив их~для нового понятия формулы (\S\,\ref{sec:Pred}, с.~\pageref{praedformula}). Как мы~уже знаем (см. теорему~\ref{correct} и~теорему~\ref{th:predtaut}), их~применение будет давать общезначимые формулы сигнатуры. Добавим, кроме того, следующие схемы и~правила вывода, касающиеся кванторов:

\begin{itemize}
\item $\forall$-схема: для любой формулы~$A$, переменной~$x$ и~терма~$t$, если подстановка~$(t|x) A$ корректна, $\forall xA \imp (t|x) A$.
\item $\forall$-правило Бернайса\indBernays: если~$x$ не~входит в~$A$ свободно, то~\[\frac{\vdash A \imp B}{\vdash A \imp \forall xB}.\]
\item $\exists$-схема: для любой формулы~$A$, переменной~$x$ и~терма~$t$, если подстановка~$(t|x) A$ корректна, $(t|x) A \imp \exists xA$.
\item $\exists$-правило Бернайса: если~$x$ не~входит в~$B$ свободно, то~\[\frac{\vdash A \imp B}{\vdash\exists xA \imp B}.\]
\end{itemize}

В этих схемах и~правилах вновь проявляется <<родство>> квантора~$\forall$ с~конъюнкцией и~квантора~$\exists$ с~дизъюнкцией. К~примеру, $\forall$-схема схожа со~схемами $A \& B \imp A$, $A \& B \imp B$~ (они говорят о~том, \emph{что} можно получить из~конъюнкции и~квантора всеобщности), а~$\forall$-правило схоже со~схемой $(A \imp B) \imp ((A \imp C) \imp (A \imp B \& C))$ (они говорят о~том, \emph{как} можно получить конъюнкцию и~квантор). Отметим также, что только лишь~$\forall$- и~$\exists$-схем нам было бы~недостаточно: исчисление, не~содержащее правил Бернайса, согласовывалось бы, например, с~такой интерпретацией, при которой формула вида $\exists x A$ всегда истинна, а~$\forall x A$ всегда ложна.

\begin{exercise}\cite{Lavrov04}. Являются ли~выводами в~исчислении предикатов следующие последовательности формул:

1\rp\ $\forall x \exists y A(x, y) \imp \exists y A(y, y)$;

2\rp\ $\forall x P(x) \imp P(y)$, $\forall x P(x) \imp \forall y P(y)$;

3\rp\ $A(x) \imp \exists x A(x)$, $(A(x) \imp \exists x A(x)) \imp (\forall x A(x) \imp (A(x) \imp \exists x A(x)))$, $\forall x A(x) \imp (A(x) \imp \exists x A(x))$?

Ответы: 1\rp\ нет: попытка воспользоваться~$\forall$-схемой, но~некорректная подстановка, 2\rp\ да: $\forall$-схема, $\forall$-правило, 3\rp\ да: $\exists$-схема, первая схема исчисления высказываний, modus ponens.
\end{exercise}

\begin{exercise}Докажите, что для произвольной формулы~$A$ выводимо $\forall x A \imp \exists x A$.
\end{exercise}
\begin{theorem}\label{predcorrect}
Всякая выводимая в~исчислении предикатов формула является общезначимой (если~$\vdash A$, то~$\models A$).
\end{theorem}

\beginproof Как и~при доказательстве теоремы~\ref{correct}, необходимо проверить, что схемы дают общезначимые формулы, а~правила вывода сохраняют общезначимость. Схемы, перенесённые из~исчисления высказываний, являются пропозициональными тавтологиями; следовательно, в~силу теоремы~\ref{th:predtaut} при подстановке в~них вместо букв~$A$, $B$, $C$ произвольных формул сигнатуры они будут давать общезначимые формулы.

Теорема~\ref{th:forallexistsax} показывает, что~$\forall$- и~$\exists$-схемы дают общезначимые формулы.

Доказательство того факта, что правило modus ponens сохраняет общезначимость, полностью аналогично данному в~теореме~\ref{correct}, за~тем исключением, что фразу \emph{на любом наборе пропозициональных переменных} необходимо заменить на~\emph{на любой модели и~оценке}.

Остаются правила Бернайса. Пусть $\models A\imp B$ и~$x$ не~входит в~$A$ свободно. Пусть~$A$ истинна на~некоторой оценке~$\pi$. В~силу того, что она не~зависит от~$x$, она истинна также и~на~любой оценке~$\pi'$, отличающейся от~$\pi$ значением переменной~$x$. В~силу $\models A\imp B$, в~этих случаях~$B$ также является истинной, а~значит, является истинной $\forall x B$. Значит, истинность~$A$ в~некоторой оценке~$\pi$ является достаточным условием истинности $\forall x B$ в~той же~оценке; следовательно, ${\models A\imp \forall x B}$, что и~требовалось доказать.

Для второго правила Бернайса рассуждение симметричное. Пусть $\models A\imp B$ и~$x$ не~входит свободно в~$B$. Пусть $\exists x A$ истинна на~некоторой оценке~$\pi$. Это значит, что существует оценка~$\pi'$, отличающаяся от~$\pi$ только значением переменной~$x$, на~которой~$A$ истинна. В~силу $\models A\imp B$ на~оценке~$\pi'$ также должна быть истинна и~$B$. Но~$\pi'$ отличается от~$\pi$ только значением переменной~$x$, от~которой~$B$ не~зависит; следовательно, $B$ будет истинным и~в~оценке~$\pi$. Значит, истинность $\exists x A$ в~некоторой оценке~$\pi$ является достаточным условием истинности~$B$ в~той же~оценке; следовательно, $\models \exists x A \imp B$, что и~требовалось доказать.\endproof

Как и~в~случае с~исчислением высказываний, тут же~вытекает

\begin{follow}Не существует формулы~$A$, такой, что одновременно~$\vdash A$ и~$\vdash \neg A$ в~исчислении предикатов.\end{follow}

\beginproof Доказательство полностью аналогично доказательству следствия из~теоремы~\ref{correct}, нужно лишь рассуждать не~в~терминах наборов пропозициональных переменных, а~в~терминах моделей и~оценок.\endproof

\p Будем говорить, что формулы~$A$ и~$B$ \emph{доказуемо эквивалентны}, и~писать \[A \sim B,\] если одновременно имеет место $\vdash A \imp B$ и~$\vdash B\imp A$. (Это определение с~учётом теоремы о~полноте исчисления высказываний согласуется с~данным на~с.~\pageref{def:propequivalence} для пропозициональных формул.) Таким образом, установление доказуемой эквивалентности сводится к~поиску вывода двух указанных импликаций.

\p Ниже рассматриваются некоторые наиболее употребимые на~практике классы выводимых формул логики предикатов. Прежде всего отметим, что запас навыков, набранный при изучении исчисления высказываний, пригодится и~при решении задач формального вывода в~исчислении предикатов. Если известно, что~$A$~--- формула, выводимая в~исчислении высказываний, то~замена в~ней пропозициональных переменных на~формулы исчисления предикатов будет формулой, выводимой в~исчислении предикатов (из~аксиом по~правилу modus ponens). Кроме того, можно пользоваться теоремой о~полноте исчисления высказываний и~считать выводимой любую формулу, полученную из~пропозициональной тавтологии. Мы~пока что не~ввели понятие вывода из~посылок для исчисления предикатов и~не~будем пользоваться приёмами вывода из~посылок по~причине, которая станет ясна ниже. Но~это ни~в~коем случае не~<<дисквалифицирует>> формулы, выведенные в~исчислении высказываний с~помощью таких приёмов, т.~к. для всех них можно эффективно построить и~обычный вывод из~аксиом по~правилу modus ponens.

\p[Правило обобщения.]\label{lemma:gen} Докажем, что для любой формулы~$A$, если она выводима, то~выводима также $\forall x A$, т.~е. справедливо правило вывода \[\frac{\vdash A}{\vdash \forall x A}.\]

Возьмём какую-нибудь замкнутую (т.~е. не~содержащую свободных переменных) выводимую формулу~$B$. Такая формула существует: например, можно воспользоваться формулой~$A' \imp A'$, где~$A'$ получена из~$A$ навешиванием любых кванторов по~всем свободным переменным. Тогда
\begin{enumerate}
	\item $\vdash A \imp (B \imp A)$~--- схема 1,
	\item $\vdash B \imp A$~--- modus ponens к~шагу~1 и~$\vdash A$,
	\item $\vdash B \imp \forall x A$~--- $\forall$-правило к~шагу~2, которое допустимо применить в~силу замкнутости формулы~$B$,
	\item $\vdash\forall xA$~--- modus ponens к~шагу~3 и~$\vdash B$, что и~требовалось.
\end{enumerate}

\p[Законы коммутативности] кванторов формулируются следующим образом: если~$A$~--- произвольная формула, то~справедливы следующие соотношения:

\begin{enumerate}
\item $ \forall x \forall y A \sim \forall y \forall x A$,
\item $ \exists x \exists y A \sim \exists y \exists x A$,
\item $ \vdash \exists x \forall y A \imp \forall y \exists x A$.
\end{enumerate}

Заметим, что в~последнем случае импликация верна только в~одну сторону.
\begin{exercise}Покажите, что $\not \vdash \forall y \exists x A \imp \exists x \forall y A$. \end{exercise}

Докажем первое утверждение. \[\vdash \forall x \forall y A \imp \forall y A\mbox{~--- $\forall$-схема,}\]\[\vdash \forall y A \imp A\mbox{~--- $\forall$-схема.}\]

Теперь если бы~в~нашем распоряжении было правило вывода \[\frac{\vdash A \imp B, \vdash B \imp C}{\vdash A \imp C}\] (а~мы~его сейчас обоснуем), то~мы~могли бы~заключить также \[\vdash \forall x \forall y A \imp A.\]

Левая часть этой импликации не~зависит от~$x$ и~от~$y$ (эти переменные связаны кванторами), поэтому можно дважды применить~$\forall$-правило Бернайса и~получить \[\vdash \forall x \forall y A \imp \forall y \forall x A,\] что и~требовалось доказать. Доказательство утверждения в~обратную сторону будет тем же, только с~переставленными именами переменных.

Теперь обоснуем обещанное правило вывода, которым будем пользоваться и~в~дальнейшем. Пусть $\vdash A \imp B$ и~$\vdash B \imp C$. Тогда

\begin{enumerate}
\item $\vdash (A \imp B) \imp ((A \imp (B \imp C)) \imp (A \imp C))$~--- схема 2,
\item $\vdash (A \imp (B \imp C)) \imp (A \imp C)$~--- modus ponens к~$\vdash A \imp B$ и~шагу~1.
\item $\vdash (B \imp C) \imp (A \imp (B \imp C))$~--- схема 1,
\item $\vdash A \imp (B \imp C)$~--- modus ponens к~$\vdash B \imp C$ и~3,
\item $\vdash A \imp C$~--- modus ponens к~шагам~4 и~2, что и~требовалось доказать.
\end{enumerate}
\begin {exercise}Докажите второй и~третий законы коммутативности кванторов. Указание: доказывая
$\exists x \forall y A \imp \forall y \exists x A$, докажите сперва $\vdash \forall y A \imp \exists x A$.\end{exercise}

\begin{exercise}Обоснуйте правила вывода \[\frac{\vdash \exists x A , \vdash A \imp B}{\vdash \exists x B},\quad \frac{\vdash \forall x A , \vdash A \imp B}{\vdash \forall x B}.\]
\end{exercise}

\p[Законы де~М\'органа\indMorgan] для кванторов: для произвольной формулы~$A$,

\begin{enumerate}
\item$ \exists xA \sim \neg \forall x \neg A$,
\item$\forall x A \sim \neg \exists x \neg A $.
\end{enumerate}

Действительно: докажем, например, что $\vdash \exists xA \imp \neg \forall x \neg A$. Т.~к. правая часть импликации не~содержит~$x$, то~достаточно доказать $A \imp \neg \forall x \neg A$, откуда можно было бы~перейти к~требуемой формуле по~правилу Бернайса. По~закону контрапозиции достаточно доказать $\forall x \neg A \imp \neg A$, но~это аксиома. Переписывая наше рассуждение в~обратном порядке, получим вывод для $\exists xA \imp \neg \forall x \neg A$.

Остальные импликации, составляющие содержание законов де~Моргана, доказываются аналогично. Докажем, что $\vdash \neg \forall x \neg A \imp \exists xA$. Имея в~виду закон контрапозиции, достаточно доказать $\neg \exists xA \imp \forall x \neg A$, имея в~виду~$\forall$-правило~--- $\neg \exists xA \imp \neg A$. Применяя контрапозицию ещё раз, достаточно доказать $A \imp \exists xA$, но~это аксиома. Переписывая формулы в~обратном порядке, получим вывод для $\neg \forall x \neg A \imp \exists xA$.

\begin{exercise}Докажите второй закон де~Моргана.\end{exercise}

При помощи контрапозиции мы~можем перейти и~к~такой форме законов де~Моргана: $\neg \exists xA \sim \forall x\neg A$, $\neg \forall x A \sim \exists x \neg A$.

\p Пусть для некоторых формул~$A$, $B$ имеет место $\vdash A \imp B$. Докажем, что при этом $\vdash \forall x A \imp \forall x B$ и~$\vdash \exists x A \imp \exists x B$.

В силу~$\forall$-схемы, $\vdash \forall x A \imp A$, откуда $\vdash \forall x A \imp B$. Т.~к. $x$ не~входит в~$\forall x A$ свободно, то~$\vdash \forall x A \imp \forall x B$. Аналогично, в~силу~$\exists$-схемы\linebreak[1] $\vdash B \imp \exists x B$, $\vdash A \imp \exists x B$ и~по~правилу Бернайса $\vdash \exists x A \imp \exists x B$.

Таким образом, если~$A \sim B$, то~$\forall x A \sim \forall x B$ и~$\exists x A \sim \exists x B$. Отсюда легко доказывается следующая важная лемма.

\begin{lemma}[о замене подформулы]\label{lemma:eqsubst} Замена подформулы на~доказуемо эквивалентную даёт формулу, доказуемо эквивалентную исходной.\end{lemma}

\beginproof Проведём доказательство индукцией по~построению, начиная с~заменённой подформулы и~рассматривая всё более длинные части формулы. Заменённая подформула эквивалентна исходной подформуле по~условию. Теперь

\begin{itemize}
	\item если~$A \sim A'$, то~$\neg A \sim \neg A'$, т.~к. имеют место тавтологии $(A \imp A') \imp (\neg A' \imp \neg A)$ и~$(A' \imp A) \imp (\neg A \imp \neg A')$,
	\item если~$A \sim A'$ и~$B \sim B'$, то~$A \& B \sim A' \& B'$, т.~к. имеют место тавтологии $(A \imp A') \imp ((B \imp B') \imp ((A\&B) \imp (A' \& B')))$, $(A' \imp A) \imp ((B' \imp B) \imp ((A'\&B') \imp (A \& B)))$,
	\item аналогично для других пропозициональных связок,
	\item если~$A \sim B$, то, по~доказанному выше, $\forall x A \sim \forall x B$ и~$\exists x A \sim \exists x B$.\endproof
\end{itemize}


\p Законы \textbf{пронесения квантора всеобщности через конъюнкцию} и~\textbf{пронесения квантора существования через дизъюнкцию} формулируются следующим образом: для любых формул~$A$, $B$

\begin{enumerate}
	\item $\forall x A \& \forall x B \sim \forall x (A \& B)$,
	\item $\exists x A \vee \exists x B \sim \exists x (A \vee B)$.
\end{enumerate}

В самом деле: $\vdash \forall x A \& \forall x B \imp \forall x A$, $\vdash \forall x A \imp A$, откуда $\vdash \forall x A \& \forall x B \imp A$ и~аналогично $\vdash \forall x A \& \forall x B \imp B$. Воспользовавшись схемой аксиом $(A \imp B) \imp ((A \imp C) \imp (A \imp B \& C))$ и~правилом modus ponens, имеем \[\vdash \forall x A \& \forall x B \imp A \& B.\] Но~переменная~$x$ не~входит свободно в~левую часть доказанной конъюнкции, поэтому можно воспользоваться правилом Бернайса и~заключить \[\vdash \forall x A \& \forall x B \imp \forall x (A \& B),\] что и~требовалось. В~обратную сторону: от~$\forall x (A \& B)$ доказываем импликацию к~$A \& B$, затем по~отдельности к~$A$ и~$B$, затем по~правилу обобщения~--- к~$\forall xA$ и~$\forall xB$ и~объединяем в~конъюнкцию с~помощью аксиомы $(\forall x (A \& B) \imp \forall xA) \imp ((\forall x (A \& B) \imp \forall xB)\imp (\forall x (A \& B) \imp \forall xA \& \forall x B))$.

\begin{exercise}Докажите по~аналогии закон пронесения квантора существования через дизъюнкцию.\end{exercise}

Заметим, что \emph{нельзя} аналогичным образом выносить квантор в~начало формул вида $\forall x A \vee \forall x B$ и~$\exists x A \& \exists x B$. Обдумайте это\footnote{\,В~книге \cite{VereShen2} при обсуждении законов пронесения кванторов авторы приводят такой пример: <<В одном из~выступлений начала перестройки М.",С.~Горбачёв сказал, что нужны \glqq преданные делу социализма, но~квалифицированные специалисты\grqq\ldots Так вот, их~существование не~следует из~отдельного существования тех и~других.>>}.

\begin{exercise}Докажите, что $\vdash \forall x A \& \exists x B \imp \exists x (A \& B)$.\end{exercise}

Рассмотренные нами законы де~Моргана, коммутативности и~пронесения кванторов не~предполагали каких-либо ограничений на~вид подчиняющимся им~формул. Выведем теперь ряд законов, предполагающих определённые ограничения на~свободные вхождения переменных в~формулы.

\p[Корректное переименование связанных переменных.]\label{lemma:linkrename} Пусть~$A$~--- формула. Рассмотрим две последовательности формул:

\begin{enumerate}
	\item $\forall x A \imp (y \mid x)A$, $\forall x A \imp \forall y (y\mid x) A$.
	\item $(y \mid x)A \imp \exists x A$, $\exists y (y \mid x)A \imp \exists x A$.
\end{enumerate}

Чтобы эти последовательности были корректными выводами, требуется, во-первых, чтобы подстановка $(y \mid x)A$ была корректной (и~тогда первый шаг станет аксиомой), а~во-вторых~--- чтобы переменная~$y$ не~содержалась свободно в~$A$ (и~тогда второй шаг будет получаем из~первого по~правилу Бернайса).

Если оба условия выполняются, то~мы~можем утверждать, что $\vdash \forall x A \imp \forall y (y\mid x) A$ и~$\vdash \exists y (y \mid x)A \imp \exists x A$. Но~тогда импликации будут верны и~в~обратную сторону! В~самом деле: т.~к. подстановка $(y \mid x)A$ заменяет все свободные вхождения~$x$ на~$y$, то~формула $(y \mid x)A$ не~содержит~$x$ свободно. Может ли~быть некорректной обратная подстановка $(x \mid y)(y \mid x)A$, т.~е. возможно ли, чтобы переменная~$x$, подставленная вместо какого-либо из~свободных вхождений~$y$ в~формулу $(y \mid x)A$, подпала под действие одноимённого квантора? Т.~к. переменная~$y$ не~входила свободно в~формулу~$A$, то~все свободные вхождения~$y$ в~формулу $(y \mid x)A$ есть результат текстовой замены \emph{свободных}, т.~е. не~связанных кванторами, вхождений буквы~$x$ в~формулу~$A$. Обратная подстановка вновь заменит все эти свободные вхождения~$y$ в~формуле $(y \mid x)A$ на~$x$, и в~силу только что сказанного все эти~$x$ будут свободными. Таким образом, обратная подстановка $(x \mid y)(y \mid x)A$ корректна и~в~результате её мы~получим исходную формулу~$A$.

Условия <<подстановка $(y \mid x) A$ корректна и~$y$ не~входит в~$A$ свободно>> мы~будем называть \emph{условиями на~корректное переименование связанной переменной}. Из~изложенного следует, что если эти условия выполняются, то

\begin{enumerate}
	\item $\forall x A \sim \forall y (y \mid x)A$,
	\item $\exists x A \sim \exists y (y \mid x)A$.
\end{enumerate}

Только что доказанное и~лемма~\ref{lemma:eqsubst} о~замене подформулы дают нам возможность строго обосновать эквивалентность конгруэнтных формул.

\begin{theorem}\label{th:cong}Конгруэнтные формулы доказуемо эквивалентны.\end{theorem}

\beginproof Заметим, что переименование связанных переменных, сохраняющее схему формулы, является корректным. В~самом деле, пусть формула имеет, например, вид \[\forall\bridge{x \underbrace{\ldots z \ldots \forall \bridge{y \ldots y} \ldots x}_A}.\]

Нарушение условия на~корректность подстановки привело бы~к~появлению новых связей в~формуле~$(y\mid x)A$: \[\forall{y\underbrace{\ldots z \ldots \forall \bridge{\bridge{y \ldots y} \ldots y}}_{(y\mid x)A}},\] а~нарушение условия на~отсутствие свободных вхождений~--- к~связыванию прежде свободных переменных:

\[\lefteqn{\forall\bridge{\bridge{\phantom{z \ldots z}} \phantom{\ldots \forall} \bridge{\phantom{y \ldots y}} \phantom{ \ldots z}}}
\forall z \underbrace{\ldots z \ldots \forall y \ldots y \ldots z}_{(z\mid x)A}.\]

Используя ранее не~использованные ни~в~$A$, ни~в~$B$ переменные для замены связанных, мы~можем две конгруэнтные формулы~$A$ и~$B$ привести к~третьей формуле~$C$, которая будет конгруэнтна и~доказуемо эквивалентна формулам~$A$ и~$B$. Т.~к. обе формулы~$A$ и~$B$ эквивалентны~$C$, то~они эквивалентны и~друг другу.\endproof


\p[Навешивание фиктивных кванторов.] Если~$x$ не~входит свободно в~формулу~$B$, то\[B\sim \forall x B \sim \exists x B.\]

Доказательство простое. Если~$x$ не~входит в~$B$ свободно, то~$B \imp \forall x B$ и~$\exists x B \imp B$~--- аксиомы, а~$\forall x B \imp B$ и~$B \imp \exists x B$ получаются из~выводимой формулы~$B \imp B$ (вспомним лемму~\ref{AimpA}!) по~$\forall$- и~$\exists$-правилам Бернайса.

\p[Законы пронесения] кванторов в~общем виде: для любой формулы~$A$ и~формулы~$B$, такой, что~$x$ не~содержится в~$B$ свободно, справедливы следующие восемь утверждений об~эквивалентности:

\begin{multicols}{2}
\begin{enumerate}
\item $\forall xA \& B \sim \forall x (A \& B)$,
\item $B \& \forall xA \sim \forall x (A \& B)$,
\item $\exists xA \vee B \sim \exists x (A \vee B)$,
\item $B \vee \exists xA \sim \exists x (A \vee B)$,
\item $\exists xA \& B \sim \exists x (A \& B)$,
\item $B \& \exists xA \sim \exists x (A \& B)$,
\item $\forall xA \vee B \sim \forall x (A \vee B)$,
\item $B \vee \forall xA \sim \forall x (A \vee B)$.
\end{enumerate}
\end{multicols}

Первые четыре утверждения являются несложным обобщением законов пронесения квантора всеобщности через конъюнкцию и~квантора существования через дизъюнкцию. В~самом деле, раз~$x$ не~содержится в~$B$ свободно, мы~можем навесить на~$B$ фиктивный квантор, воспользоваться леммой~\ref{lemma:eqsubst} о~замене подформулы и~соответствующими законами пронесения кванторов: например, \[\forall xA \& B \sim \forall xA \& \forall x B \sim \forall x (A \& B),\] и~аналогично в~других случаях.

Утверждения с~пятого по~восьмое доказать уже не~так просто~--- без использования сведения к~противоречию не~обойтись.

Докажем пятое и~шестое утверждения в~одну сторону. Для краткости обозначим буквой~$F$ формулу \[(\exists x A \& B) \& \neg (\exists x (A\& B)),\] доказуемо эквивалентную формуле $\neg (\exists x A \& B \imp \exists x (A\& B))$.

Выведем из~$F$ противоречие, т.~е. докажем сначала $\vdash F \imp \exists x A$, а~затем $\vdash F \imp \neg \exists x A$, откуда будет следовать $\vdash \neg F$ и~$\vdash \exists x A \& B \imp \exists x (A\& B)$, что нам и~требуется.

Формула $\vdash F \imp \exists x A$ выводится элементарно~--- двойным применением схемы $A \& B \imp A$. Выведем теперь $\vdash F \imp \neg \exists x A$.

Действительно, из~$F$ можно последовательно вывести импликации к~формулам $\neg \exists x (A\&B)$, $\forall x \neg (A\&B)$~--- закон де~Моргана, $\neg (A\&B)$~---$\forall$-схема, наконец, в~силу того что $\neg (A\&B) \imp (B \imp \neg A)$, имеем \[\vdash F \imp (B \imp \neg A).\]

С другой стороны, $\vdash F \imp B$, по~второй схеме $\vdash (F \imp B) \imp ((F \imp (B \imp \neg A)) \imp (F \imp \neg A))$ и, применяя дважды modus ponens, имеем \[\vdash F \imp \neg A.\]

Но~$F$ не~содержит свободно~$x$ (вот где мы~задействовали тот факт, что~$x$ не~содержится в~$B$ свободно), поэтому можно применить правило Бернайса и~заключить $F \imp \forall x \neg A$, $\vdash F \imp \neg \exists x A$, но~это противоречие с~$\vdash F \imp \exists x A$. Доказательство не~изменится, если поменять местами~$B$ и~$\exists x A$. Тем самым пятое и~шестое утверждения в~одну сторону доказаны.

Докажем пятое и~шестое утверждения в~обратную сторону. Теперь обозначим через~$F$ формулу \[(\exists x (A\& B)) \& \neg (\exists x A \& B),\] доказуемо эквивалентную $\neg ( \exists x (A\& B)\imp \exists x A \& B)$. Выведем противоречие: ${\vdash F} \imp \exists x (A\& B)$ и~$\vdash F \imp \neg \exists x (A\& B)$, откуда будет $\vdash \neg F$ и~$\vdash\exists x (A\& B)\imp \exists x A \& B$, что нам и~требуется.

Для произвольных формул~$A$ и~$B$ имеет место \[\vdash \neg B \imp \neg (A \& B),\] а~от~формулы $\forall x \neg A$ можно последовательно вывести импликации к: $\neg A$~--- $\forall$-схема, $\neg A \vee \neg B$~--- схема для дизъюнкции, $\neg (A \& B)$~--- закон де~Моргана для высказываний. Итак, для произвольных~$A$ и~$B$ имеет место \[\vdash \forall x \neg A \imp \neg (A \& B).\]

Воспользовавшись соответствующей схемой, имеем \[\begin{array}{l} \vdash (\neg B \imp \neg (A \& B)) \imp ( (\forall x \neg A \imp \neg (A \& B))\imp\\ \quad \quad\quad\imp (\forall x \neg A \vee \neg B\imp \neg (A \& B))),\end{array}\] и, применив дважды modus ponens с~учётом уже выведенных формул, получим \[\forall x \neg A \vee \neg B\imp \neg (A \& B).\]

Т. к. $x$ не~входит свободно в~левую часть (опять играет роль соглашение, принятое относительно формулы~$B$!), можно воспользоваться правилом Бернайса и~вывести последовательно $\vdash \forall x \neg A \vee \neg B\imp \forall x \neg (A \& B)$, $\vdash \forall x \neg A \vee \neg B\imp \neg \exists x (A \& B)$.

Но от~формулы~$F$ можно последовательно вывести импликацию к~$\neg (\exists x A \& B)$ и~$\forall x \neg A \vee \neg B$, откуда окончательно \[\vdash F \imp \neg \exists x (A \& B),\] и~мы~пришли к~искомому противоречию.

Используя законы де~Моргана и~эквивалентности 5 и~6, не~составляет труда доказать оставшиеся две эквивалентности 7 и~8. Например, $\neg (\forall xA \vee B) \sim \exists x \neg A \& \neg B \sim \exists x (\neg A \& \neg B) \sim \exists x \neg (A \vee B) \sim \neg \forall x (A\vee B)$, откуда $\forall xA \vee B \sim \forall x (A\vee B)$.

Теперь, если предположить, что~$y$ не~входит свободно в~формулы $\forall x A$, $\exists x A$, а~$x$ не~входит свободно в~формулы~$\forall yB$, $\exists yB$ (чего всегда можно добиться соответствующим корректным переименованием связанных переменных), то~будут справедливы, например, следующие эквивалентности: $\forall x A \vee \forall y B \sim \forall x \forall y (A \vee B)$, $\exists x A \& \exists y B \sim \exists x \exists y (A \& B)$, $\forall x A \vee \exists y B \sim \forall x \exists y (A \vee B) \sim \exists y \forall x (A \vee B)$ и~т.~д. Заметим, что в~последнем случае порядок следования кванторов ($\forall \exists$ или $\exists \forall$) не~имеет значения, тогда как в~общем случае он, как мы~знаем, важен.

\p Будем говорить, что формула находится в~\emph{предварённой, или пренексной, нормальной форме}, если она имеет вид \[\vect {\mathsf Q}n F ,\] где каждый $\mathsf Q_i$~--- квантор~$\forall$ или~$\exists$, а~формула~$F$ не~содержит кванторов. Выведенные в~этом параграфе законы позволяют доказать следующее утверждение:

\begin{theorem}Для любой формулы логики предикатов имеется эквивалентная ей~формула в~предварённой нормальной форме (ПНФ).\end{theorem}

\beginproof Как обычно, воспользуемся индукцией по~построению.

\begin{itemize}
\item Атомарные формулы находятся в~ПНФ в~соответствии с~определением.
\item Пусть формула имеет вид $\forall x A$, и в~соответствии с~предположением индукции имеется~$A' \sim A$, где~$A'$~--- формула в~предварённой нормальной форме. Тогда $\forall x A'$ также находится в~ПНФ, и в~силу леммы~\ref{lemma:eqsubst} о~замене подформулы $\forall x A' \sim \forall x A$.
\item То~же~самое для случая~$\exists xA$.
\item Пусть формула имеет вид~$\neg A$, и~$A'$~--- ПНФ для~$A$. Последовательно применяя законы де~Моргана $\neg \forall x A \sim \exists x \neg A$ и~$\neg \exists x A \sim \forall x\neg A$, мы~можем <<продвинуть>> знак отрицания вплоть до~бескванторной части формулы~$A'$, по~ходу меняя кванторы на~сопряжённые, получив в~итоге ПНФ для формулы~$\neg A$.
\item Пусть формула имеет вид~$A \& B$, и~имеются~$A'$, $B'$~--- ПНФ для формул~$A$, $B$ соответственно. Последовательно применяя законы пронесения, мы~можем один за~другим перенести все кванторы в~начало формулы. При этом на~каждом шаге, возможно, потребуется переименование связанных переменных, чтобы создать условия применимости законов пронесения кванторов.

Если на~каком-то этапе оба аргумента конъюнкции начинаются с~квантора всеобщности, то~переименованием связанных переменных приводим конъюнкцию к~виду $\forall x A' \& \forall x B'$, что эквивалентно $\forall x (A' \& B')$. Во~всех остальных случаях переименовываем связанную переменную одной из~формул так, чтобы она не~входила свободно в~другую формулу, и~пользуемся соответствующим законом пронесения в~общем виде. На~каждом шаге количество не~перенесённых кванторов уменьшается на~один или два, поэтому за~конечное число шагов процесс завершится.

\item Аналогично для случая~$A \vee B$.

\item Если формула имеет вид~$A \imp B$, то~заменяем её на~эквивалентную $\neg A \vee B$, чем сводим задачу к~уже рассмотренным случаям.\endproof
\end{itemize}

\begin{exercise}\cite{Lavrov04,VereShen2}. Привести к~предварённой нормальной форме следующие формулы:

\[\begin{array}{ll}
\neg \exists x \forall y \exists z P(x, y, z), &
\exists x \forall y P(x, y) \& \exists x \forall y Q(x,y),\\
\exists x \forall y P(x, y) \vee \exists x \forall y Q(x,y), &
\exists x \forall y P(x, y) \imp \exists x \forall y Q(x,y),\\
\forall x P(x) \imp \forall x Q(x),&
\exists x \forall y P(x, y) \imp \forall y \exists x P(x, y).
\end{array}\]

Частичное решение:

\begin{enumerate}\raggedright
	\item $\neg \exists x \forall y \exists z P(x, y, z) \sim \forall x \exists y \forall z \neg P(x, y, z)$.

	\item $\exists x \forall y P(x, y) \& \exists x \forall y Q(x, y) \sim  \exists x \forall y P(x, y) \& \exists u \forall y Q(u, y) \sim
 \exists x \exists u (\forall y P(x, y) \& \forall y Q(u, y)) \sim \exists x \exists u \forall y (P(x, y) \& Q(u, y))$.


	\item $\forall x P(x) \imp \forall x Q(x) \sim  \neg \forall x P(x) \vee \forall y Q(y) \sim \exists x \neg P(x) \vee \forall y Q(y) \sim  \exists x \forall y (P(x) \imp Q(y)) \sim \forall y \exists x (P(x) \imp Q(y))$.

	\item $\exists x \forall y P(x, y) \imp \forall y \exists x P(x, y) \sim \forall x \exists z \neg P(x, z) \vee \forall y \exists z P(z, y) \sim
 \forall x \forall y (\exists z \neg P(x, z) \vee \exists z P(z, y)) \sim  \forall x \forall y \exists z (P(x, z) \imp P(z, y))$.
\end{enumerate}

\end{exercise}